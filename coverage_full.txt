============================= test session starts ==============================
platform linux -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- /home/daretechie/DevProject/GitHub/CloudSentinel-AI/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/daretechie/DevProject/GitHub/CloudSentinel-AI
configfile: pyproject.toml
plugins: anyio-4.12.1, mock-3.15.1, langsmith-0.6.2, respx-0.22.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1219 items

tests/adapters/test_aws_adapter.py::test_get_daily_costs_success PASSED  [  0%]
tests/adapters/test_aws_adapter.py::test_get_daily_costs_failure PASSED  [  0%]
tests/adapters/test_aws_cur.py::test_ingest_latest_parquet PASSED        [  0%]
tests/adapters/test_aws_cur_streaming.py::test_ingest_latest_parquet_streaming PASSED [  0%]
tests/adapters/test_aws_multitenant.py::test_get_credentials_success PASSED [  0%]
tests/adapters/test_aws_multitenant.py::test_get_credentials_cached PASSED [  0%]
tests/adapters/test_aws_multitenant.py::test_get_credentials_expired PASSED [  0%]
tests/adapters/test_aws_multitenant.py::test_get_daily_costs_success PASSED [  0%]
tests/adapters/test_aws_multitenant.py::test_get_daily_costs_pagination PASSED [  0%]
tests/adapters/test_aws_multitenant.py::test_get_daily_costs_error_handling PASSED [  0%]
tests/adapters/test_azure_backend.py::test_azure_verify_connection_success PASSED [  0%]
tests/adapters/test_azure_backend.py::test_azure_verify_connection_failure PASSED [  0%]
tests/adapters/test_azure_unit.py::TestAzureAdapterDateParsing::test_parse_row_yyyymmdd_int PASSED [  1%]
tests/adapters/test_azure_unit.py::TestAzureAdapterDateParsing::test_parse_row_yyyymmdd_string PASSED [  1%]
tests/adapters/test_azure_unit.py::TestAzureAdapterDateParsing::test_parse_row_iso_string PASSED [  1%]
tests/adapters/test_connections_unit.py::test_verify_connection_success PASSED [  1%]
tests/adapters/test_connections_unit.py::test_verify_connection_failure PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURAdapterInitialization::test_adapter_initializes PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURAdapterInitialization::test_adapter_default_region PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURAdapterInitialization::test_adapter_custom_region PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURConfig::test_config_initialization PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURConfig::test_config_custom_format PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURConfig::test_config_from_dict PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURConfig::test_config_from_dict_with_format PASSED [  1%]
tests/adapters/test_cur_adapter_root.py::TestCURDateRanges::test_monthly_range PASSED [  2%]
tests/adapters/test_cur_adapter_root.py::TestCURDateRanges::test_cross_month_range PASSED [  2%]
tests/adapters/test_cur_adapter_root.py::TestCURDateRanges::test_cross_year_range PASSED [  2%]
tests/adapters/test_cur_adapter_root.py::TestCURAdapterMethods::test_has_get_daily_costs PASSED [  2%]
tests/adapters/test_cur_adapter_root.py::TestCURAdapterMethods::test_has_get_gross_usage PASSED [  2%]
tests/adapters/test_cur_adapter_root.py::TestCURAdapterMethods::test_has_get_resource_usage PASSED [  2%]
tests/adapters/test_cur_automation.py::test_iam_cur_manager_setup_success PASSED [  2%]
tests/adapters/test_cur_automation.py::test_iam_cur_manager_bucket_exists PASSED [  2%]
tests/adapters/test_gcp_backend.py::test_gcp_verify_sa_success PASSED    [  2%]
tests/adapters/test_gcp_backend.py::test_gcp_verify_oidc_success PASSED  [  2%]
tests/adapters/test_multi_cloud_parity.py::test_gcp_multi_credit_extraction PASSED [  2%]
tests/adapters/test_multi_cloud_parity.py::test_untagged_recommendations PASSED [  2%]
tests/analysis/test_azure_usage_analyzer.py::TestAzureUsageAnalyzerIdleVMs::test_detects_idle_vm PASSED [  3%]
tests/analysis/test_azure_usage_analyzer.py::TestAzureUsageAnalyzerIdleVMs::test_empty_records_returns_empty PASSED [  3%]
tests/analysis/test_azure_usage_analyzer.py::TestAzureUsageAnalyzerDisks::test_detects_unattached_disk PASSED [  3%]
tests/analysis/test_azure_usage_analyzer.py::TestAzureUsageAnalyzerSQL::test_detects_idle_sql_database PASSED [  3%]
tests/analysis/test_azure_usage_analyzer.py::TestAzureUsageAnalyzerAKS::test_detects_idle_aks_cluster PASSED [  3%]
tests/analysis/test_azure_usage_analyzer.py::TestAzureUsageAnalyzerNICs::test_detects_orphan_nic PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestCarbonCalculatorInitialization::test_calculator_initializes PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestEmissionCalculations::test_kwh_to_co2 PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestEmissionCalculations::test_compute_instance_emissions PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestEmissionCalculations::test_storage_emissions PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestGridIntensity::test_us_east_intensity PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestGridIntensity::test_green_regions PASSED [  3%]
tests/analysis/test_carbon_calc.py::TestCarbonEquivalencies::test_miles_driven PASSED [  4%]
tests/analysis/test_carbon_calc.py::TestCarbonEquivalencies::test_trees_needed PASSED [  4%]
tests/analysis/test_carbon_calc.py::TestCarbonEquivalencies::test_smartphone_charges PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestCarbonCalculation::test_calculate_from_costs_basic PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestCarbonCalculation::test_low_carbon_region PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestCarbonCalculation::test_high_carbon_region PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestCarbonCalculation::test_zero_cost_returns_zero_carbon PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestCarbonCalculation::test_empty_cost_data PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestCarbonCalculation::test_unknown_region_uses_default PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestEquivalencies::test_equivalencies_included PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestEquivalencies::test_equivalencies_scale_with_carbon PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestRegionConfiguration::test_all_major_regions_configured PASSED [  4%]
tests/analysis/test_carbon_calculator.py::TestRegionConfiguration::test_default_region_configured PASSED [  5%]
tests/analysis/test_finops_analyzer.py::TestFinOpsAnalyzerInstantiation::test_requires_llm PASSED [  5%]
tests/analysis/test_finops_analyzer.py::TestAnalyze::test_invokes_llm_with_cost_data PASSED [  5%]
tests/analysis/test_finops_analyzer.py::TestAnalyze::test_returns_parsed_result PASSED [  5%]
tests/analysis/test_finops_analyzer.py::TestAnalyze::test_handles_markdown_wrapped_json PASSED [  5%]
tests/analysis/test_finops_analyzer.py::TestAnalyze::test_handles_invalid_json_gracefully PASSED [  5%]
tests/analysis/test_finops_analyzer.py::TestAnalyze::test_handles_empty_cost_data PASSED [  5%]
tests/analysis/test_forecaster_markers.py::test_forecast_with_anomaly_markers PASSED [  5%]
tests/analysis/test_forecaster_markers.py::test_holt_winters_confidence_bands PASSED [  5%]
tests/analysis/test_forecasting_realism.py::test_outlier_detection_logic PASSED [  5%]
tests/analysis/test_forecasting_realism.py::test_confidence_intervals_present PASSED [  5%]
tests/analysis/test_forecasting_realism.py::test_interval_growth_over_time PASSED [  5%]
tests/analysis/test_forecasting_realism.py::test_mape_accuracy_tracking PASSED [  5%]
tests/analysis/test_forecasting_realism.py::test_forecast_edge_cases_zero_cost PASSED [  6%]
tests/analysis/test_forecasting_realism.py::test_forecast_insufficient_data_protection PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerIdleVMs::test_detects_idle_vm_low_cpu PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerIdleVMs::test_active_vm_not_flagged PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerIdleVMs::test_gpu_vm_flagged_with_type PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerDisks::test_detects_orphan_disk PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerDisks::test_active_disk_not_flagged PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerCloudSQL::test_detects_idle_cloud_sql PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerGKE::test_detects_empty_gke_cluster PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerOrphanIPs::test_detects_orphan_ip PASSED [  6%]
tests/analysis/test_gcp_usage_analyzer.py::TestGCPUsageAnalyzerEmpty::test_empty_records_returns_empty PASSED [  6%]
tests/analysis/test_graviton_analyzer.py::test_analyze_instances_finds_candidates PASSED [  6%]
tests/analysis/test_greenops_2.py::test_forecast_carbon PASSED           [  7%]
tests/analysis/test_greenops_2.py::test_is_low_carbon_window PASSED      [  7%]
tests/analysis/test_greenops_2.py::test_green_scheduling_delays_in_non_green_window PASSED [  7%]
tests/analysis/test_prophet_forecaster.py::test_forecaster_insufficient_data PASSED [  7%]
tests/analysis/test_prophet_forecaster.py::test_forecaster_prophet_success PASSED [  7%]
tests/analysis/test_prophet_forecaster.py::test_forecaster_fallback_holt_winters PASSED [  7%]
tests/analysis/test_scope3_accuracy.py::test_scope3_calculation PASSED   [  7%]
tests/analysis/test_scope3_accuracy.py::test_carbon_forecasting PASSED   [  7%]
tests/analysis/test_zombie_analyzer.py::TestZombieAnalyzerInitialization::test_analyzer_initializes PASSED [  7%]
tests/analysis/test_zombie_analyzer.py::TestZombieAnalyzerInitialization::test_analyzer_stores_llm PASSED [  7%]
tests/analysis/test_zombie_analyzer.py::TestZombieAnalyzerMethods::test_has_analyze_method PASSED [  7%]
tests/analysis/test_zombie_analyzer.py::TestZombieAnalyzerMethods::test_analyze_is_async PASSED [  7%]
tests/analysis/test_zombie_analyzer.py::TestAnalysisResults::test_result_structure PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestAnalysisResults::test_finding_structure PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestAnalysisResults::test_confidence_in_range PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestConfidenceScoring::test_high_confidence PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestConfidenceScoring::test_medium_confidence PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestConfidenceScoring::test_low_confidence PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestRecommendations::test_recommendations_list PASSED [  8%]
tests/analysis/test_zombie_analyzer.py::TestRecommendations::test_recommendation_is_actionable PASSED [  8%]
tests/analysis/test_zombie_coverage.py::test_scan_for_tenant_no_connections PASSED [  8%]
tests/analysis/test_zombie_coverage.py::test_scan_for_tenant_multi_provider PASSED [  8%]
tests/analysis/test_zombie_coverage.py::test_enrich_with_ai_tier_restriction PASSED [  8%]
tests/analysis/test_zombie_coverage.py::test_enrich_with_ai_success PASSED [  8%]
tests/analysis/test_zombie_coverage.py::test_scan_provider_error_handling PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestZombieDetectorInstantiation::test_default_region PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestZombieDetectorInstantiation::test_custom_region PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestZombieDetectorInstantiation::test_credentials_storage PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestZombieDetectorInstantiation::test_plugins_loaded PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestZombieDetectorInstantiation::test_all_plugin_types_present PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestPluginInterface::test_all_plugins_have_category_key PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestPluginInterface::test_category_keys_are_unique PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestPluginInterface::test_all_plugins_have_scan_method PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestEstimatedCosts::test_all_cost_keys_present PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestEstimatedCosts::test_all_costs_are_positive PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestScanAll::test_returns_dict_with_metadata PASSED [  9%]
tests/analysis/test_zombie_detector.py::TestScanAll::test_aggregates_plugin_results PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestScanAll::test_calculates_total_waste PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestScanAll::test_handles_plugin_failure_gracefully PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestUnattachedVolumesPlugin::test_category_key PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestUnattachedVolumesPlugin::test_inherits_from_zombie_plugin PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestUnattachedVolumesPlugin::test_has_scan_method PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestOldSnapshotsPlugin::test_category_key PASSED [ 10%]
tests/analysis/test_zombie_detector.py::TestIdleS3BucketsPlugin::test_category_key PASSED [ 10%]
tests/analysis/test_zombie_multi_cloud_plugins.py::test_azure_orphaned_images_plugin_scan PASSED [ 10%]
tests/analysis/test_zombie_multi_cloud_plugins.py::test_gcp_unused_ips_plugin_scan PASSED [ 10%]
tests/analysis/test_zombie_multi_cloud_plugins.py::test_gcp_machine_images_plugin_scan PASSED [ 10%]
tests/analysis/test_zombie_multi_cloud_plugins.py::test_azure_detector_lifecycle PASSED [ 10%]
tests/analysis/test_zombie_multi_cloud_plugins.py::test_gcp_detector_initialization PASSED [ 10%]
tests/analysis/test_zombie_orchestration.py::test_zombie_service_scan_for_tenant_no_connections PASSED [ 11%]
tests/analysis/test_zombie_orchestration.py::test_remediation_service_create_request PASSED [ 11%]
tests/analysis/test_zombie_orchestration.py::test_remediation_service_approve PASSED [ 11%]
tests/analysis/test_zombie_orchestration.py::test_remediation_service_execute_delete_volume PASSED [ 11%]
tests/analysis/test_zombie_orchestration.py::test_remediation_service_schedules_grace_period PASSED [ 11%]
tests/analysis/test_zombie_orchestration.py::test_zombie_service_enrich_with_ai_tier_restriction PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestZombiePluginModule::test_plugins_package_exists PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestZombiePluginBase::test_plugin_class_exists PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestZombiePluginBase::test_plugin_is_abstract_base PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestPluginResults::test_zombie_result_structure PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestPluginResults::test_scan_result_aggregation PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestPluginResults::test_results_groupable_by_type PASSED [ 11%]
tests/analysis/test_zombie_plugins.py::TestPluginCategories::test_storage_category_logic PASSED [ 12%]
tests/api/test_api_endpoints.py::TestHealthEndpoint::test_health_returns_200 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestCostsEndpoint::test_costs_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestCostsEndpoint::test_costs_with_invalid_token_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestAnalyzeEndpoint::test_analyze_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestLLMUsageEndpoint::test_llm_usage_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestCarbonEndpoint::test_carbon_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestZombiesEndpoint::test_zombies_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestZombiesEndpoint::test_zombies_request_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestZombiesEndpoint::test_zombies_approve_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestAdminEndpoint::test_admin_trigger_without_key_returns_422 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestConnectionsEndpoint::test_sync_org_without_auth_returns_401 PASSED [ 12%]
tests/api/test_api_endpoints.py::TestConnectionsEndpoint::test_list_discovered_without_auth_returns_401 PASSED [ 13%]
tests/api/test_api_endpoints.py::TestConnectionsEndpoint::test_link_discovered_without_auth_returns_401 PASSED [ 13%]
tests/api/test_health.py::test_health_service_all_ok PASSED              [ 13%]
tests/api/test_health.py::test_health_endpoint PASSED                    [ 13%]
tests/api/test_health.py::test_health_db_failure PASSED                  [ 13%]
tests/api/test_pagination.py::test_zombie_detector_instantiation PASSED  [ 13%]
tests/api/test_settings_api.py::TestNotificationSettings::test_notification_settings_schema PASSED [ 13%]
tests/api/test_settings_api.py::TestNotificationSettings::test_notification_toggle PASSED [ 13%]
tests/api/test_settings_api.py::TestCarbonSettings::test_carbon_settings_schema PASSED [ 13%]
tests/api/test_settings_api.py::TestCarbonSettings::test_carbon_alert_threshold PASSED [ 13%]
tests/api/test_settings_api.py::TestLLMSettings::test_llm_settings_schema PASSED [ 13%]
tests/api/test_settings_api.py::TestLLMSettings::test_valid_providers PASSED [ 13%]
tests/api/test_settings_api.py::TestActiveOpsSettings::test_activeops_settings_schema PASSED [ 14%]
tests/api/test_settings_api.py::TestActiveOpsSettings::test_safety_limits PASSED [ 14%]
tests/api/test_settings_api.py::TestActiveOpsSettings::test_approval_required_default PASSED [ 14%]
tests/billing/test_billing.py::TestSubscriptionResponse::test_subscription_response_model PASSED [ 14%]
tests/billing/test_billing.py::TestSubscriptionResponse::test_subscription_response_optional_date PASSED [ 14%]
tests/billing/test_billing.py::TestCheckoutRequest::test_checkout_request_valid_tier PASSED [ 14%]
tests/billing/test_billing.py::TestCheckoutRequest::test_checkout_request_optional_callback PASSED [ 14%]
tests/billing/test_billing.py::TestCheckoutRequest::test_checkout_request_with_callback PASSED [ 14%]
tests/billing/test_billing.py::TestBillingService::test_billing_service_exists PASSED [ 14%]
tests/billing/test_billing.py::TestBillingService::test_billing_service_has_required_methods PASSED [ 14%]
tests/billing/test_billing.py::TestWebhookHandler::test_webhook_signature_verification_invalid PASSED [ 14%]
tests/billing/test_billing.py::TestWebhookHandler::test_webhook_subscription_create PASSED [ 14%]
tests/billing/test_billing.py::TestPricingTier::test_pricing_tier_values PASSED [ 15%]
tests/billing/test_billing.py::TestPricingTier::test_pricing_tier_from_string PASSED [ 15%]
tests/billing/test_billing.py::TestTenantSubscriptionModel::test_tenant_subscription_fields PASSED [ 15%]
tests/billing/test_financial_precision.py::test_financial_precision_decimal_sum PASSED [ 15%]
tests/billing/test_financial_precision.py::test_float_comparison_failure_simulation PASSED [ 15%]
tests/billing/test_tier_guard.py::TestFeatureAccess::test_free_tier_has_basic_features PASSED [ 15%]
tests/billing/test_tier_guard.py::TestFeatureAccess::test_free_tier_no_ai_insights PASSED [ 15%]
tests/billing/test_tier_guard.py::TestFeatureAccess::test_starter_tier_has_ai_insights PASSED [ 15%]
tests/billing/test_tier_guard.py::TestFeatureAccess::test_starter_no_slack PASSED [ 15%]
tests/billing/test_tier_guard.py::TestFeatureAccess::test_professional_tier_full_features PASSED [ 15%]
tests/billing/test_tier_guard.py::TestFeatureAccess::test_enterprise_tier_all_features PASSED [ 15%]
tests/billing/test_tier_guard.py::TestTierLimits::test_free_tier_limits PASSED [ 15%]
tests/billing/test_tier_guard.py::TestTierLimits::test_starter_tier_limits PASSED [ 15%]
tests/billing/test_tier_guard.py::TestTierLimits::test_professional_tier_limits PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierLimits::test_enterprise_tier_unlimited PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierLimits::test_unknown_limit_returns_zero PASSED [ 16%]
tests/billing/test_tier_guard.py::TestGetTenantTier::test_no_subscription_returns_free PASSED [ 16%]
tests/billing/test_tier_guard.py::TestGetTenantTier::test_subscription_returns_tier PASSED [ 16%]
tests/billing/test_tier_guard.py::TestGetTenantTier::test_db_error_returns_free PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierGuard::test_guard_has_feature PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierGuard::test_guard_limit PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierGuard::test_guard_require_raises_on_missing_feature PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierFeatureMatrix::test_all_tiers_defined PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierFeatureMatrix::test_all_tiers_have_limits PASSED [ 16%]
tests/billing/test_tier_guard.py::TestTierFeatureMatrix::test_higher_tier_superset PASSED [ 16%]
tests/core/test_cache_service.py::TestCacheServiceDisabled::test_disabled_when_no_credentials PASSED [ 17%]
tests/core/test_cache_service.py::TestCacheServiceDisabled::test_get_analysis_returns_none_when_disabled PASSED [ 17%]
tests/core/test_cache_service.py::TestCacheServiceDisabled::test_set_analysis_returns_false_when_disabled PASSED [ 17%]
tests/core/test_cache_service.py::TestCacheServiceEnabled::test_get_analysis_returns_cached_data PASSED [ 17%]
tests/core/test_cache_service.py::TestCacheServiceEnabled::test_set_analysis_stores_data_with_ttl PASSED [ 17%]
tests/core/test_cache_service.py::TestCacheServiceEnabled::test_get_analysis_handles_errors_gracefully PASSED [ 17%]
tests/core/test_cache_service.py::TestCacheServiceSingleton::test_get_cache_service_returns_same_instance PASSED [ 17%]
tests/core/test_circuit_breaker.py::TestCircuitBreakerConfig::test_config_default_values PASSED [ 17%]
tests/core/test_circuit_breaker.py::TestCircuitBreakerConfig::test_config_custom_values PASSED [ 17%]
tests/core/test_circuit_breaker.py::TestCircuitBreakerState::test_memory_fallback_get PASSED [ 17%]
tests/core/test_circuit_breaker.py::TestCircuitBreakerState::test_memory_fallback_set_get PASSED [ 17%]
tests/core/test_circuit_breaker.py::TestCircuitBreakerState::test_memory_fallback_incr PASSED [ 17%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_initial_state_closed PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_can_execute_when_closed PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_record_success_resets_failures PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_record_failure_increments_count PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_circuit_opens_after_threshold PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_reset_clears_state PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_budget_check PASSED [ 18%]
tests/core/test_circuit_breaker.py::TestCircuitBreaker::test_get_status PASSED [ 18%]
tests/core/test_config_validation.py::test_config_production_validation PASSED [ 18%]
tests/core/test_config_validation.py::test_config_dev_validation_passes PASSED [ 18%]
tests/core/test_delta_analysis.py::TestCostDelta::test_is_significant_above_threshold PASSED [ 18%]
tests/core/test_delta_analysis.py::TestCostDelta::test_is_significant_below_threshold PASSED [ 18%]
tests/core/test_delta_analysis.py::TestCostDelta::test_is_spike_over_50_percent PASSED [ 19%]
tests/core/test_delta_analysis.py::TestCostDelta::test_is_drop_over_30_percent PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisResult::test_has_significant_changes_with_increases PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisResult::test_has_significant_changes_with_new_resources PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisResult::test_no_significant_changes PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisResult::test_as_llm_prompt_data_is_compact PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisResult::test_as_json_serializes PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisService::test_compute_delta_with_increases PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisService::test_compute_delta_detects_new_resources PASSED [ 19%]
tests/core/test_delta_analysis.py::TestDeltaAnalysisService::test_compute_delta_filters_small_changes PASSED [ 19%]
tests/core/test_delta_analysis.py::TestAnalyzeWithDelta::test_returns_cached_result_when_available PASSED [ 19%]
tests/core/test_delta_analysis.py::TestAnalyzeWithDelta::test_returns_no_changes_when_stable PASSED [ 19%]
tests/core/test_graceful_degradation.py::test_graceful_degradation_soft_limit PASSED [ 20%]
tests/core/test_graceful_degradation.py::test_hard_limit_blocking PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_initial_state_is_closed PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_is_available_when_closed PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_opens_after_failure_threshold PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_success_resets_failure_count PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_half_open_after_recovery_timeout PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_closes_after_success_in_half_open PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_per_provider_isolation PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_protect_raises_when_open PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_get_status PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreaker::test_reset PASSED [ 20%]
tests/core/test_llm_circuit_breaker.py::TestLLMCircuitBreakerSingleton::test_get_circuit_breaker_returns_singleton PASSED [ 21%]
tests/core/test_llm_guardrails_stress.py::test_llm_guardrails_unicode_homoglyphs PASSED [ 21%]
tests/core/test_llm_guardrails_stress.py::test_llm_guardrails_jailbreak_keywords PASSED [ 21%]
tests/core/test_llm_guardrails_stress.py::test_llm_guardrails_whitespace_obfuscation PASSED [ 21%]
tests/core/test_llm_guardrails_stress.py::test_legitimate_cost_data_passes PASSED [ 21%]
tests/core/test_llm_security.py::test_sanitize_input_nested PASSED       [ 21%]
tests/core/test_llm_security.py::test_validate_output_valid PASSED       [ 21%]
tests/core/test_llm_security.py::test_validate_output_malformed PASSED   [ 21%]
tests/core/test_middleware.py::TestRequestIDMiddleware::test_middleware_exists PASSED [ 21%]
tests/core/test_middleware.py::TestRequestIDMiddleware::test_middleware_adds_request_id PASSED [ 21%]
tests/core/test_middleware.py::TestSecurityHeadersMiddleware::test_middleware_exists PASSED [ 21%]
tests/core/test_middleware.py::TestSecurityHeadersMiddleware::test_middleware_adds_security_headers PASSED [ 21%]
tests/core/test_middleware.py::TestTimeoutMiddleware::test_middleware_importable PASSED [ 21%]
tests/core/test_middleware.py::TestTimeoutMiddleware::test_middleware_accepts_timeout PASSED [ 22%]
tests/core/test_middleware.py::TestRateLimitMiddleware::test_rate_limit_importable PASSED [ 22%]
tests/core/test_public_assessment.py::test_public_assessment_endpoint PASSED [ 22%]
tests/core/test_public_assessment.py::test_public_assessment_rate_limiting PASSED [ 22%]
tests/core/test_rate_limit_stress.py::test_legitimate_cost_data_passes PASSED [ 22%]
tests/core/test_rate_limit_stress.py::test_rate_limiter_stress_5000_instances PASSED [ 22%]
tests/core/test_slack_service.py::TestSendAlert::test_send_alert_info_severity PASSED [ 22%]
tests/core/test_slack_service.py::TestSendAlert::test_send_alert_warning_severity PASSED [ 22%]
tests/core/test_slack_service.py::TestSendAlert::test_send_alert_critical_severity PASSED [ 22%]
tests/core/test_slack_service.py::TestSendAlert::test_send_alert_api_failure PASSED [ 22%]
tests/core/test_slack_service.py::TestSendDigest::test_send_digest_success PASSED [ 22%]
tests/core/test_slack_service.py::TestSendDigest::test_send_digest_handles_missing_stats PASSED [ 22%]
tests/core/test_slack_service.py::TestSendDigest::test_send_digest_api_failure PASSED [ 23%]
tests/core/test_usage_tracker.py::TestCalculateCost::test_groq_llama_cost_calculation PASSED [ 23%]
tests/core/test_usage_tracker.py::TestCalculateCost::test_openai_gpt4o_cost_calculation PASSED [ 23%]
tests/core/test_usage_tracker.py::TestCalculateCost::test_anthropic_claude_cost_calculation PASSED [ 23%]
tests/core/test_usage_tracker.py::TestCalculateCost::test_unknown_model_returns_fallback_cost PASSED [ 23%]
tests/core/test_usage_tracker.py::TestCalculateCost::test_known_provider_unknown_model_returns_provider_default PASSED [ 23%]
tests/core/test_usage_tracker.py::TestCalculateCost::test_zero_tokens_returns_zero PASSED [ 23%]
tests/core/test_usage_tracker.py::TestLLMPricing::test_all_providers_have_at_least_one_model PASSED [ 23%]
tests/core/test_usage_tracker.py::TestLLMPricing::test_all_models_have_input_output_pricing PASSED [ 23%]
tests/core/test_usage_tracker.py::TestRecordUsage::test_record_creates_usage_entry PASSED [ 23%]
tests/core/test_usage_tracker.py::TestBudgetCheck::test_no_alert_when_no_budget_set PASSED [ 23%]
tests/core/test_usage_tracker.py::TestBudgetCheck::test_no_alert_under_threshold PASSED [ 23%]
tests/fixes/test_all_fixes.py::TestRLSEnforcement::test_rls_missing_context_throws_exception PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestRLSEnforcement::test_rls_with_context_passes PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestRLSEnforcement::test_rls_exception_prevents_cross_tenant_query PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestLLMBudgetCheck::test_budget_exceeded_returns_402 PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestLLMBudgetCheck::test_budget_reservation_is_atomic PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestLLMBudgetCheck::test_usage_recorded_after_llm_call PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestLLMBudgetCheck::test_zero_budget_blocks_all_requests PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestJobTimeout::test_job_timeout_after_duration PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestJobTimeout::test_job_completes_within_timeout PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestJobTimeout::test_timeout_retries_exponential_backoff PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestSchedulerAtomicity::test_scheduler_uses_single_transaction PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestSchedulerAtomicity::test_scheduler_skip_locked_prevents_blocking PASSED [ 24%]
tests/fixes/test_all_fixes.py::TestSchedulerAtomicity::test_scheduler_deadlock_retry_exponential_backoff PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestJobTenantIsolation::test_job_sets_tenant_context PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestJobTenantIsolation::test_job_cannot_access_other_tenant_data PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestEncryptionSaltManagement::test_salt_generation_is_random PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestEncryptionSaltManagement::test_salt_is_never_hardcoded PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestEncryptionSaltManagement::test_encrypt_decrypt_roundtrip PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestEncryptionSaltManagement::test_kdf_iterations_exceeds_minimum PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestProductionIntegration::test_full_pipeline_with_all_fixes PASSED [ 25%]
tests/fixes/test_all_fixes.py::TestPerformance::test_encryption_latency PASSED [ 25%]
tests/governance/test_audit_log.py::TestAuditEventType::test_auth_events PASSED [ 25%]
tests/governance/test_audit_log.py::TestAuditEventType::test_resource_events PASSED [ 25%]
tests/governance/test_audit_log.py::TestAuditEventType::test_remediation_events PASSED [ 25%]
tests/governance/test_audit_log.py::TestAuditEventType::test_billing_events PASSED [ 26%]
tests/governance/test_audit_log.py::TestAuditLogModel::test_audit_log_has_required_fields PASSED [ 26%]
tests/governance/test_audit_log.py::TestAuditLogModel::test_audit_log_table_name PASSED [ 26%]
tests/governance/test_audit_log.py::TestAuditLogger::test_logger_initialization PASSED [ 26%]
tests/governance/test_audit_log.py::TestAuditLogger::test_logger_with_correlation_id PASSED [ 26%]
tests/governance/test_audit_log.py::TestAuditLogger::test_log_creates_entry PASSED [ 26%]
tests/governance/test_audit_log.py::TestAuditLogger::test_log_with_details_triggers_masking PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_password_field PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_token_field PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_api_key_field PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_external_id PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_nested_sensitive_fields PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_handles_non_dict PASSED [ 26%]
tests/governance/test_audit_log.py::TestSensitiveDataMasking::test_mask_list_of_dicts PASSED [ 27%]
tests/governance/test_audit_log.py::TestAuditLoggerSensitiveFields::test_sensitive_fields_include_secrets PASSED [ 27%]
tests/governance/test_audit_phase_1.py::test_paystack_ip_validation_enforced PASSED [ 27%]
tests/governance/test_audit_phase_1.py::test_csrf_middleware_behavior PASSED [ 27%]
tests/governance/test_audit_phase_1.py::test_tenant_isolation_standard_endpoint PASSED [ 27%]
tests/governance/test_audit_phase_2.py::test_zombie_detector_factory_pass_through PASSED [ 27%]
tests/governance/test_audit_phase_2.py::test_llm_factory_key_validation PASSED [ 27%]
tests/governance/test_audit_phase_2.py::test_rate_limiter_hash_usage PASSED [ 27%]
tests/governance/test_audit_phase_2.py::test_aws_detector_boto_config_injection PASSED [ 27%]
tests/governance/test_audit_remediation_lifecycle.py::test_remediation_lifecycle_audit PASSED [ 27%]
tests/governance/test_audit_remediation_lifecycle.py::test_audit_log_masking_integrity PASSED [ 27%]
tests/governance/test_audit_verification.py::test_duplicate_azure_connection_fails PASSED [ 27%]
tests/governance/test_audit_verification.py::test_pagination_bounds_m4 PASSED [ 28%]
tests/governance/test_audit_verification.py::test_job_type_hardening_m5 PASSED [ 28%]
tests/governance/test_audit_verification.py::test_startup_validation_q1 PASSED [ 28%]
tests/governance/test_autonomous_logic.py::test_autonomous_dry_run_safety PASSED [ 28%]
tests/governance/test_autonomous_logic.py::test_autonomous_auto_pilot_execution PASSED [ 28%]
tests/governance/test_autonomous_logic.py::test_autonomous_low_confidence_safety PASSED [ 28%]
tests/governance/test_cleanup_logic.py::test_batched_cleanup PASSED      [ 28%]
tests/governance/test_cost_aggregator.py::test_cost_aggregator_basic_breakdown PASSED [ 28%]
tests/governance/test_cost_aggregator.py::test_cost_aggregator_tenant_isolation PASSED [ 28%]
tests/governance/test_cost_cache_root.py::TestInMemoryCache::test_get_nonexistent_key PASSED [ 28%]
tests/governance/test_cost_cache_root.py::TestInMemoryCache::test_set_and_get PASSED [ 28%]
tests/governance/test_cost_cache_root.py::TestInMemoryCache::test_delete_key PASSED [ 28%]
tests/governance/test_cost_cache_root.py::TestInMemoryCache::test_delete_pattern PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestInMemoryCache::test_health_check PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCache::test_get_daily_costs_miss PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCache::test_set_and_get_daily_costs PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCache::test_zombie_scan_caching PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCache::test_analysis_caching PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCache::test_health_check_returns_dict PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCacheKeyGeneration::test_key_is_deterministic PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCacheKeyGeneration::test_different_inputs_different_keys PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCacheKeyGeneration::test_key_starts_with_prefix PASSED [ 29%]
tests/governance/test_cost_cache_root.py::TestCostCacheFactory::test_factory_returns_cache PASSED [ 29%]
tests/governance/test_cost_governance.py::test_get_governance_report PASSED [ 29%]
tests/governance/test_cost_governance.py::test_get_governance_report_healthy PASSED [ 30%]
tests/governance/test_cost_persistence.py::test_cost_persistence_idempotency XFAIL [ 30%]
tests/governance/test_detector.py::test_detect_zombies_aggregation PASSED [ 30%]
tests/governance/test_detector.py::test_detect_zombies_partial_failure PASSED [ 30%]
tests/governance/test_detector.py::test_create_remediation_request PASSED [ 30%]
tests/governance/test_detector.py::test_approve_request PASSED           [ 30%]
tests/governance/test_detector.py::test_execute_request_success PASSED   [ 30%]
tests/governance/test_detector_core.py::TestZombieDetectorInitialization::test_detector_initializes PASSED [ 30%]
tests/governance/test_detector_core.py::TestZombieDetectorInitialization::test_detector_default_region PASSED [ 30%]
tests/governance/test_detector_core.py::TestZombieDetectorInitialization::test_detector_stores_credentials PASSED [ 30%]
tests/governance/test_detector_core.py::TestZombieDetectorPlugins::test_has_plugins PASSED [ 30%]
tests/governance/test_detector_core.py::TestZombieDetectorPlugins::test_plugin_count PASSED [ 30%]
tests/governance/test_detector_core.py::TestZombieDetectorScan::test_scan_all_method_exists PASSED [ 31%]
tests/governance/test_detector_core.py::TestZombieDetectorScan::test_scan_returns_dict PASSED [ 31%]
tests/governance/test_detector_core.py::TestZombieDetectorResults::test_result_structure PASSED [ 31%]
tests/governance/test_detector_core.py::TestZombieDetectorResults::test_waste_calculation PASSED [ 31%]
tests/governance/test_detector_core.py::TestZombieDetectorResults::test_category_grouping PASSED [ 31%]
tests/governance/test_detector_core.py::TestMultiRegionScanning::test_region_list PASSED [ 31%]
tests/governance/test_detector_core.py::TestMultiRegionScanning::test_result_includes_region PASSED [ 31%]
tests/governance/test_fail_closed_budget.py::test_budget_reproduction_fail_closed PASSED [ 31%]
tests/governance/test_fail_closed_budget.py::test_budget_allowed_when_healthy PASSED [ 31%]
tests/governance/test_hard_limit_enforcement.py::test_enforce_hard_limit_auto_executes PASSED [ 31%]
tests/governance/test_hard_limit_enforcement.py::test_enforce_hard_limit_ignores_low_confidence PASSED [ 31%]
tests/governance/test_iam_auditor.py::test_iam_auditor_admin_risk PASSED [ 31%]
tests/governance/test_iam_auditor.py::test_iam_auditor_least_privilege_compliance PASSED [ 31%]
tests/governance/test_ingestion_pipeline.py::test_end_to_end_cost_ingestion_pipeline XFAIL [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_process_pending_jobs_empty_queue PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_marks_job_running_on_start PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_marks_job_completed_on_success PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_retries_on_failure PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_dead_letter_on_max_attempts PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_increments_attempts PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobProcessor::test_handles_missing_handler PASSED [ 32%]
tests/governance/test_job_processor.py::TestEnqueueJob::test_creates_job_with_defaults PASSED [ 32%]
tests/governance/test_job_processor.py::TestEnqueueJob::test_respects_scheduled_for PASSED [ 32%]
tests/governance/test_job_processor.py::TestJobBackoff::test_backoff_exponential PASSED [ 32%]
tests/governance/test_remediation_atomicity.py::test_execute_fails_if_backup_fails PASSED [ 32%]
tests/governance/test_remediation_atomicity.py::test_execute_success_with_audit_trail PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_execute_action_ec2_variations PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_execute_action_rds_variations PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_execute_action_s3_and_ecr PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_execute_action_redshift_and_elb PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_execute_action_sagemaker PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_create_backups PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_execute_action_invalid PASSED [ 33%]
tests/governance/test_remediation_coverage.py::test_aws_action_error_handling PASSED [ 33%]
tests/governance/test_savings_autopilot.py::test_savings_processor_executes_autonomous_ready PASSED [ 33%]
tests/governance/test_savings_autopilot.py::test_savings_processor_skips_non_autonomous PASSED [ 33%]
tests/governance/test_scheduler.py::TestSchedulerInstantiation::test_creates_scheduler PASSED [ 33%]
tests/governance/test_scheduler.py::TestSchedulerInstantiation::test_stores_session_maker PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerInstantiation::test_creates_semaphore PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerInstantiation::test_initial_status PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStatus::test_returns_dict PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStatus::test_contains_running_flag PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStatus::test_contains_last_run_info PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStatus::test_contains_job_list PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStart::test_registers_daily_job PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStart::test_registers_weekly_remediation_job PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStart::test_scheduler_is_running PASSED [ 34%]
tests/governance/test_scheduler.py::TestSchedulerStop::test_stop_calls_shutdown PASSED [ 34%]
tests/governance/test_scheduler.py::TestDailyAnalysisJob::test_fetches_all_tenants PASSED [ 34%]
tests/governance/test_scheduler.py::TestDailyAnalysisJob::test_updates_last_run_status PASSED [ 35%]
tests/governance/test_scheduler.py::TestDailyAnalysisJob::test_processes_multiple_tenants PASSED [ 35%]
tests/governance/test_scheduler_concurrency.py::test_scheduler_concurrency_lock PASSED [ 35%]
tests/governance/test_verification.py::test_llm_factory_byok_priority PASSED [ 35%]
tests/governance/test_verification.py::test_scheduler_concurrency PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestIdempotencyKey::test_generates_consistent_key PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestIdempotencyKey::test_different_refs_different_keys PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestIdempotencyKey::test_key_is_32_chars PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestWebhookRetryService::test_is_duplicate_returns_false_for_new PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestWebhookRetryService::test_is_duplicate_returns_true_for_existing PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestWebhookRetryService::test_max_attempts_configured PASSED [ 35%]
tests/governance/test_webhook_retry.py::TestWebhookProcessing::test_supported_events PASSED [ 35%]
tests/integration/auth/test_auth_integration.py::test_tenant_isolation PASSED [ 36%]
tests/integration/auth/test_auth_integration.py::test_role_enforcement PASSED [ 36%]
tests/integration/billing/test_paystack_flows.py::test_create_checkout_success[asyncio] PASSED [ 36%]
tests/integration/billing/test_paystack_flows.py::test_webhook_charge_success_activates_subscription[asyncio] PASSED [ 36%]
tests/integration/billing/test_paystack_flows.py::test_webhook_invalid_signature_rejection[asyncio] PASSED [ 36%]
tests/integration/optimization/test_remediation_lifecycle.py::test_remediation_lifecycle_full[asyncio] PASSED [ 36%]
tests/integration/test_cost_aggregation.py::test_cost_aggregation_and_filtering PASSED [ 36%]
tests/integration/test_multi_cloud_report.py::test_multi_cloud_unified_report PASSED [ 36%]
tests/integration/test_zombie_scan.py::TestZombieDetectorFactory::test_factory_extracts_aws_credentials PASSED [ 36%]
tests/integration/test_zombie_scan.py::TestZombieDetectorFactory::test_factory_handles_azure_connection PASSED [ 36%]
tests/integration/test_zombie_scan.py::TestZombieDetectorFactory::test_factory_handles_gcp_connection PASSED [ 36%]
tests/integration/test_zombie_scan.py::TestZombieScanWithMoto::test_unattached_volume_detection_with_moto PASSED [ 36%]
tests/integration/test_zombie_scan.py::TestZombieScanWithMoto::test_old_snapshot_detection_with_moto PASSED [ 36%]
tests/integration/test_zombie_scan.py::TestPluginRegistry::test_aws_plugins_registered PASSED [ 37%]
tests/integration/test_zombie_scan.py::TestPluginRegistry::test_azure_plugins_registered PASSED [ 37%]
tests/integration/test_zombie_scan.py::TestPluginRegistry::test_gcp_plugins_registered PASSED [ 37%]
tests/security/test_auth.py::TestCurrentUserModel::test_current_user_minimal PASSED [ 37%]
tests/security/test_auth.py::TestCurrentUserModel::test_current_user_full PASSED [ 37%]
tests/security/test_auth.py::TestCurrentUserModel::test_user_roles PASSED [ 37%]
tests/security/test_auth.py::TestRoleHierarchy::test_role_hierarchy_exists PASSED [ 37%]
tests/security/test_auth.py::TestRoleHierarchy::test_owner_highest_privilege PASSED [ 37%]
tests/security/test_auth.py::TestRequiresRoleDecorator::test_requires_role_returns_callable PASSED [ 37%]
tests/security/test_auth.py::TestRequiresRoleDecorator::test_multiple_role_levels PASSED [ 37%]
tests/security/test_auth.py::TestJWTDecoding::test_jwt_decode_function_exists PASSED [ 37%]
tests/security/test_auth.py::TestJWTDecoding::test_invalid_token_raises PASSED [ 37%]
tests/security/test_auth.py::TestAuthDependencies::test_get_current_user_exists PASSED [ 38%]
tests/security/test_auth.py::TestAuthDependencies::test_get_current_user_from_jwt_exists PASSED [ 38%]
tests/security/test_blind_indexing.py::test_blind_index_generation PASSED [ 38%]
tests/security/test_blind_indexing.py::test_tenant_blind_index_listener PASSED [ 38%]
tests/security/test_blind_indexing.py::test_user_blind_index_listener PASSED [ 38%]
tests/security/test_due_diligence.py::test_remediation_rate_limiting PASSED [ 38%]
tests/security/test_due_diligence.py::test_large_query_hits_limit PASSED [ 38%]
tests/security/test_due_diligence.py::test_statement_timeout_configured PASSED [ 38%]
tests/security/test_due_diligence.py::test_anomaly_marker_schema_exists PASSED [ 38%]
tests/security/test_due_diligence.py::test_attribution_rule_model_supports_percentage_split PASSED [ 38%]
tests/security/test_due_diligence.py::test_attribution_engine_exists PASSED [ 38%]
tests/security/test_due_diligence.py::test_cost_record_has_upsert_support PASSED [ 38%]
tests/security/test_due_diligence.py::test_rls_policies_are_enforced PASSED [ 39%]
tests/security/test_due_diligence.py::test_grace_period_remediation PASSED [ 39%]
tests/security/test_due_diligence.py::test_llm_budget_enforcement PASSED [ 39%]
tests/security/test_due_diligence.py::test_attribution_rule_s3_split_60_40 PASSED [ 39%]
tests/security/test_due_diligence.py::test_concurrent_tenant_isolation PASSED [ 39%]
tests/security/test_encryption.py::test_encryption_decryption_utilities PASSED [ 39%]
tests/security/test_encryption.py::test_encryption_with_different_keys PASSED [ 39%]
tests/security/test_encryption.py::test_llm_budget_transparent_encryption PASSED [ 39%]
tests/security/test_encryption.py::test_generate_new_key PASSED          [ 39%]
tests/security/test_key_rotation.py::test_key_rotation_compatibility PASSED [ 39%]
tests/security/test_multi_tenant_safety.py::test_statement_timeout_enforcement PASSED [ 39%]
tests/security/test_multi_tenant_safety.py::test_row_limit_enforcement PASSED [ 39%]
tests/security/test_multi_tenant_safety.py::test_large_dataset_async_shift SKIPPED [ 40%]
tests/security/test_multi_tenant_safety.py::test_tier_aware_rate_limiting PASSED [ 40%]
tests/security/test_oidc_security.py::test_oidc_token_claims PASSED      [ 40%]
tests/security/test_oidc_security.py::test_oidc_jwks_structure PASSED    [ 40%]
tests/security/test_oidc_security.py::test_oidc_discovery_doc PASSED     [ 40%]
tests/security/test_privilege_escalation.py::test_member_cannot_process_jobs PASSED [ 40%]
tests/security/test_privilege_escalation.py::test_admin_can_process_jobs PASSED [ 40%]
tests/security/test_privilege_escalation.py::test_owner_bypasses_role_check PASSED [ 40%]
tests/security/test_privilege_escalation.py::test_cross_tenant_isolation PASSED [ 40%]
tests/security/test_privilege_escalation.py::test_member_cannot_enqueue_restricted_jobs PASSED [ 40%]
tests/security/test_rls_security.py::test_rls_session_tagging_request_success PASSED [ 40%]
tests/security/test_rls_security.py::test_rls_session_tagging_request_missing_tenant PASSED [ 40%]
tests/security/test_rls_security.py::test_rls_session_tagging_background_job PASSED [ 41%]
tests/security/test_rls_security.py::test_rls_listener_emits_log_on_missing_context PASSED [ 41%]
tests/security/test_role_assumption_security.py::test_adapter_arn_validation PASSED [ 41%]
tests/security/test_role_assumption_security.py::test_credential_isolation PASSED [ 41%]
tests/security/test_role_assumption_security.py::test_external_id_generation PASSED [ 41%]
tests/security/test_security_headers.py::test_security_headers_presence PASSED [ 41%]
tests/security/test_security_headers.py::test_cors_allowed_origin PASSED [ 41%]
tests/security/test_security_headers.py::test_cors_blocked_origin PASSED [ 41%]
tests/security/test_security_regression.py::test_tenant_isolation_regression PASSED [ 41%]
tests/security/test_security_regression.py::test_bound_pagination_enforcement PASSED [ 41%]
tests/security/test_security_regression.py::test_error_sanitization_middleware SKIPPED [ 41%]
tests/security/test_security_regression.py::test_security_headers_regression PASSED [ 41%]
tests/security/test_security_regression.py::test_rate_limiting_metrics_integration PASSED [ 42%]
tests/security/test_security_regression.py::test_remediation_atomicity_lock_check PASSED [ 42%]
tests/unit/adapters/test_aws_adapter.py::test_aws_adapter_verify_connection PASSED [ 42%]
tests/unit/adapters/test_aws_adapter.py::test_aws_adapter_get_cost_and_usage_client_error PASSED [ 42%]
tests/unit/adapters/test_aws_adapter.py::test_aws_adapter_stream_cost_and_usage PASSED [ 42%]
tests/unit/adapters/test_aws_adapter.py::test_aws_adapter_discover_resources PASSED [ 42%]
tests/unit/adapters/test_aws_adapter.py::test_aws_adapter_get_resource_usage PASSED [ 42%]
tests/unit/adapters/test_aws_resource_explorer.py::test_search_resources_success PASSED [ 42%]
tests/unit/adapters/test_aws_resource_explorer.py::test_is_enabled_true PASSED [ 42%]
tests/unit/adapters/test_aws_resource_explorer.py::test_is_enabled_false PASSED [ 42%]
tests/unit/adapters/test_aws_resource_explorer.py::test_search_resources_access_denied PASSED [ 42%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_verify_connection_success PASSED [ 42%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_verify_connection_failure PASSED [ 42%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_get_cost_and_usage_success PASSED [ 43%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_get_cost_and_usage_failure PASSED [ 43%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_stream_cost_and_usage PASSED [ 43%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_discover_resources_success PASSED [ 43%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_discover_resources_error PASSED [ 43%]
tests/unit/adapters/test_azure_adapter.py::test_azure_adapter_parse_row_date_formats PASSED [ 43%]
tests/unit/adapters/test_gcp_adapter.py::test_gcp_adapter_verify_connection_success PASSED [ 43%]
tests/unit/adapters/test_gcp_adapter.py::test_gcp_adapter_verify_connection_failure PASSED [ 43%]
tests/unit/adapters/test_gcp_adapter.py::test_gcp_adapter_get_cost_and_usage_success PASSED [ 43%]
tests/unit/adapters/test_gcp_adapter.py::test_gcp_adapter_get_cost_and_usage_error PASSED [ 43%]
tests/unit/adapters/test_gcp_adapter.py::test_gcp_adapter_discover_resources PASSED [ 43%]
tests/unit/adapters/test_performance.py::test_aws_adapter_streaming_performance PASSED [ 43%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_idle_vms PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_unattached_disks PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_idle_cloud_sql PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_empty_gke_clusters PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_idle_cloud_functions PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_idle_cloud_run PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_orphan_ips PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_find_old_snapshots PASSED [ 44%]
tests/unit/analysis/test_gcp_usage_analyzer_deep.py::TestGCPUsageAnalyzer::test_negative_cases_exhaust_branches PASSED [ 44%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_low_usage_instances PASSED [ 44%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_unused_ebs_volumes PASSED [ 44%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_rds_databases PASSED [ 44%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_redshift_clusters PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_nat_gateways PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_sagemaker_endpoints PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_elasticache_clusters PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_eks_clusters PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_low_usage_instances_exhaust_branches PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_unused_ebs_volumes_negative PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_rds_negative PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_redshift_negative PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_nat_negative PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_sagemaker_negative PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_elasticache_negative PASSED [ 45%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestCURUsageAnalyzer::test_find_idle_eks_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_idle_vms_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_unattached_disks_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_idle_sql_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_idle_aks_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_orphan_ips_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_unused_app_service_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_old_snapshots_negative PASSED [ 46%]
tests/unit/analysis/test_usage_analyzers_deep.py::TestAzureUsageAnalyzer::test_find_orphan_nics PASSED [ 46%]
tests/unit/api/test_audit.py::test_get_audit_logs_success PASSED         [ 46%]
tests/unit/api/test_audit.py::test_get_audit_logs_error PASSED           [ 46%]
tests/unit/api/test_audit.py::test_get_audit_log_detail_success PASSED   [ 46%]
tests/unit/api/test_audit.py::test_get_audit_log_detail_not_found PASSED [ 47%]
tests/unit/api/test_audit.py::test_get_audit_log_detail_error PASSED     [ 47%]
tests/unit/api/test_audit.py::test_get_event_types_success PASSED        [ 47%]
tests/unit/api/test_audit.py::test_export_audit_logs_success PASSED      [ 47%]
tests/unit/api/test_audit.py::test_export_audit_logs_error PASSED        [ 47%]
tests/unit/api/test_audit.py::test_request_data_erasure_confirmation_fail PASSED [ 47%]
tests/unit/api/test_audit.py::test_request_data_erasure_success PASSED   [ 47%]
tests/unit/api/test_audit.py::test_request_data_erasure_error PASSED     [ 47%]
tests/unit/api/v1/test_health_dashboard_endpoints.py::test_get_investor_health_dashboard_handler_success PASSED [ 47%]
tests/unit/api/v1/test_usage_endpoints.py::test_get_usage_metrics_handler_success PASSED [ 47%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_aws_verify_connection_success PASSED [ 47%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_aws_verify_connection_not_found PASSED [ 47%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_aws_verify_connection_failed_adapter PASSED [ 47%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_aws_verify_connection_adapter_error PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_aws_verify_connection_unexpected_error PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_azure_verify_connection_success PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_azure_verify_connection_not_found PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_azure_verify_connection_failed PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_gcp_verify_connection_success PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_gcp_verify_connection_not_found PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_gcp_verify_connection_failed PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_aws_setup_templates PASSED [ 48%]
tests/unit/connections/test_cloud_connections_deep.py::TestCloudConnectionsDeep::test_azure_list_connections PASSED [ 48%]
tests/unit/connections/test_instructions_audit.py::test_get_azure_setup_snippet PASSED [ 48%]
tests/unit/connections/test_instructions_audit.py::test_get_gcp_setup_snippet PASSED [ 48%]
tests/unit/connections/test_oidc_deep.py::TestOIDCDeep::test_get_discovery_doc PASSED [ 49%]
tests/unit/connections/test_oidc_deep.py::TestOIDCDeep::test_create_token_no_db_param PASSED [ 49%]
tests/unit/connections/test_oidc_deep.py::TestOIDCDeep::test_create_token_no_key_found PASSED [ 49%]
tests/unit/connections/test_oidc_deep.py::TestOIDCDeep::test_get_jwks_no_db_param PASSED [ 49%]
tests/unit/connections/test_oidc_deep.py::TestOIDCDeep::test_get_jwks_invalid_key_skip PASSED [ 49%]
tests/unit/connections/test_oidc_deep.py::TestOIDCDeep::test_verify_gcp_access_placeholder PASSED [ 49%]
tests/unit/connections/test_organizations_deep.py::TestOrganizationsDiscoveryDeep::test_sync_accounts_not_management PASSED [ 49%]
tests/unit/connections/test_organizations_deep.py::TestOrganizationsDiscoveryDeep::test_sync_accounts_success PASSED [ 49%]
tests/unit/connections/test_organizations_deep.py::TestOrganizationsDiscoveryDeep::test_sync_accounts_update_existing PASSED [ 49%]
tests/unit/connections/test_organizations_deep.py::TestOrganizationsDiscoveryDeep::test_sync_accounts_exception_handling PASSED [ 49%]
tests/unit/core/test_analyzer_audit.py::test_analyzer_multi_provider_fallback PASSED [ 49%]
tests/unit/core/test_analyzer_audit.py::test_analyzer_byok_injection PASSED [ 49%]
tests/unit/core/test_analyzer_audit.py::test_analyzer_audit_logging PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_create_access_token PASSED      [ 50%]
tests/unit/core/test_auth_audit.py::test_create_access_token_with_delta PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_decode_jwt_valid PASSED         [ 50%]
tests/unit/core/test_auth_audit.py::test_decode_jwt_expired PASSED       [ 50%]
tests/unit/core/test_auth_audit.py::test_decode_jwt_invalid_signature PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_from_jwt_success PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_from_jwt_no_creds PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_from_jwt_invalid_payload PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_success PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_not_found PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_no_creds PASSED [ 50%]
tests/unit/core/test_auth_audit.py::test_get_current_user_invalid_payload PASSED [ 51%]
tests/unit/core/test_auth_audit.py::test_get_current_user_unexpected_error PASSED [ 51%]
tests/unit/core/test_auth_audit.py::test_requires_role_success PASSED    [ 51%]
tests/unit/core/test_auth_audit.py::test_requires_role_forbidden PASSED  [ 51%]
tests/unit/core/test_auth_audit.py::test_require_tenant_access PASSED    [ 51%]
tests/unit/core/test_auth_core.py::test_decode_jwt_success PASSED        [ 51%]
tests/unit/core/test_auth_core.py::test_decode_jwt_expired PASSED        [ 51%]
tests/unit/core/test_auth_core.py::test_get_current_user_success PASSED  [ 51%]
tests/unit/core/test_auth_core.py::test_get_current_user_not_found PASSED [ 51%]
tests/unit/core/test_auth_core.py::test_requires_role_hierarchy_success PASSED [ 51%]
tests/unit/core/test_auth_core.py::test_requires_role_forbidden PASSED   [ 51%]
tests/unit/core/test_auth_core.py::test_require_tenant_access_success PASSED [ 51%]
tests/unit/core/test_auth_core.py::test_require_tenant_access_missing PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_decode_jwt_invalid PASSED        [ 52%]
tests/unit/core/test_auth_core.py::test_get_current_user_from_jwt_success PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_get_current_user_from_jwt_no_credentials PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_get_current_user_from_jwt_missing_sub PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_get_current_user_no_credentials PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_get_current_user_missing_sub PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_get_current_user_db_error PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_requires_role_owner_bypass PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_requires_role_unknown_role PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_requires_role_unknown_required_role PASSED [ 52%]
tests/unit/core/test_auth_core.py::test_require_tenant_access_failure PASSED [ 52%]
tests/unit/core/test_budget_manager_audit.py::test_estimate_cost_standard PASSED [ 52%]
tests/unit/core/test_budget_manager_audit.py::test_record_usage_byok_flat_fee PASSED [ 53%]
tests/unit/core/test_budget_manager_audit.py::test_check_and_reserve_hard_limit PASSED [ 53%]
tests/unit/core/test_budget_manager_audit.py::test_budget_status_soft_limit PASSED [ 53%]
tests/unit/core/test_budget_manager_audit.py::test_budget_alert_logic PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_init_disabled PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_init_enabled PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_get_analysis_hit PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_get_analysis_miss PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_set_analysis PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_invalidate_tenant PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_error_handling_get PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_error_handling_set PASSED [ 53%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_get_sync_client PASSED [ 54%]
tests/unit/core/test_cache_deep.py::TestCacheDeep::test_get_cache_service_singleton PASSED [ 54%]
tests/unit/core/test_cache_resilience.py::test_cache_service_graceful_failure PASSED [ 54%]
tests/unit/core/test_cache_resilience.py::test_cache_service_disabled_logic PASSED [ 54%]
tests/unit/core/test_circuit_breaker_resilience.py::test_circuit_breaker_state_transitions PASSED [ 54%]
tests/unit/core/test_circuit_breaker_resilience.py::test_circuit_breaker_recovery_flow PASSED [ 54%]
tests/unit/core/test_circuit_breaker_resilience.py::test_circuit_breaker_protection_decorator PASSED [ 54%]
tests/unit/core/test_circuit_breaker_resilience.py::test_circuit_breaker_reset PASSED [ 54%]
tests/unit/core/test_cloud_connection.py::test_list_all_connections PASSED [ 54%]
tests/unit/core/test_cloud_connection.py::test_verify_connection_unsupported_provider PASSED [ 54%]
tests/unit/core/test_cloud_connection.py::test_verify_connection_not_found PASSED [ 54%]
tests/unit/core/test_cloud_connection.py::test_verify_connection_success PASSED [ 54%]
tests/unit/core/test_cloud_connection.py::test_verify_connection_failure PASSED [ 55%]
tests/unit/core/test_cloud_connection.py::test_get_aws_setup_templates PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_list_all_connections PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_verify_connection_success_aws PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_verify_connection_failed_azure PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_verify_connection_not_found PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_verify_connection_unsupported_provider PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_verify_connection_internal_error PASSED [ 55%]
tests/unit/core/test_cloud_connection_audit.py::test_get_aws_setup_templates PASSED [ 55%]
tests/unit/core/test_config_audit.py::test_settings_defaults PASSED      [ 55%]
tests/unit/core/test_config_audit.py::test_settings_production_validation PASSED [ 55%]
tests/unit/core/test_config_audit.py::test_settings_production_encryption_key_length PASSED [ 55%]
tests/unit/core/test_config_audit.py::test_settings_production_ssl_mode PASSED [ 56%]
tests/unit/core/test_config_audit.py::test_settings_admin_key_env_validation PASSED [ 56%]
tests/unit/core/test_config_audit.py::test_settings_llm_provider_key_validation PASSED [ 56%]
tests/unit/core/test_config_audit.py::test_settings_is_production_property PASSED [ 56%]
tests/unit/core/test_currency.py::test_convert_usd_to_ngn_paystack_success PASSED [ 56%]
tests/unit/core/test_currency.py::test_convert_usd_fallback_rates PASSED [ 56%]
tests/unit/core/test_currency.py::test_convert_usd_to_usd PASSED         [ 56%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_paystack_no_key PASSED [ 56%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_paystack_error_response PASSED [ 56%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_paystack_invalid_data PASSED [ 56%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_public_rates_failure PASSED [ 56%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_fallback_rates_with_public PASSED [ 56%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_get_exchange_rate_cached_l1 PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_get_exchange_rate_redis_hit PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_get_exchange_rate_total_failure_returns_one PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_convert_usd_simple PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_format_currency_variants PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_paystack_success PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_paystack_missing_rate PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_paystack_exception PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_fetch_public_rates_success PASSED [ 57%]
tests/unit/core/test_currency_deep.py::TestCurrencyDeep::test_get_exchange_rate_update_redis PASSED [ 57%]
tests/unit/core/test_db_resilience.py::test_db_connection_failure PASSED [ 57%]
tests/unit/core/test_db_resilience.py::test_transaction_rollback_on_failure PASSED [ 57%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_get_db_with_request_and_tenant PASSED [ 57%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_get_db_no_request PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_set_session_tenant_id PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_before_cursor_execute PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_after_cursor_execute_slow_query PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_check_rls_policy_testing_bypass PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_check_rls_policy_production_violation PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_check_rls_policy_exempt_tables PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_check_rls_policy_system_queries PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_ssl_context_logic[disable-None-False] PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_ssl_context_logic[require-None-False] PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_ssl_context_logic[require-/fake/ca.crt-True] PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_ssl_context_logic[verify-ca-/fake/ca.crt-False] PASSED [ 58%]
tests/unit/core/test_db_session_deep.py::TestDBSessionDeep::test_ssl_context_logic[verify-full-/fake/ca.crt-False] PASSED [ 59%]
tests/unit/core/test_forecaster_audit.py::test_forecaster_fallback_logic PASSED [ 59%]
tests/unit/core/test_forecaster_audit.py::test_forecaster_prophet_trigger PASSED [ 59%]
tests/unit/core/test_forecaster_audit.py::test_outlier_detection_3sigma PASSED [ 59%]
tests/unit/core/test_forecaster_audit.py::test_carbon_math_accuracy PASSED [ 59%]
tests/unit/core/test_guardrails_audit.py::test_sanitize_input_homoglyphs PASSED [ 59%]
tests/unit/core/test_guardrails_audit.py::test_sanitize_input_fullwidth PASSED [ 59%]
tests/unit/core/test_guardrails_audit.py::test_validate_output_success PASSED [ 59%]
tests/unit/core/test_guardrails_audit.py::test_validate_output_error PASSED [ 59%]
tests/unit/core/test_guardrails_audit.py::test_adversarial_arbiter_heuristics PASSED [ 59%]
tests/unit/core/test_logging_audit.py::test_pii_redactor_nested PASSED   [ 59%]
tests/unit/core/test_logging_audit.py::test_pii_redactor_regex PASSED    [ 59%]
tests/unit/core/test_logging_audit.py::test_add_otel_trace_id PASSED     [ 60%]
tests/unit/core/test_logging_audit.py::test_audit_log_schema PASSED      [ 60%]
tests/unit/core/test_logging_audit.py::test_setup_logging_no_crash PASSED [ 60%]
tests/unit/core/test_middleware_audit.py::test_security_headers_prod PASSED [ 60%]
tests/unit/core/test_middleware_audit.py::test_security_headers_debug PASSED [ 60%]
tests/unit/core/test_middleware_audit.py::test_request_id_generation PASSED [ 60%]
tests/unit/core/test_middleware_audit.py::test_request_id_propagation PASSED [ 60%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_init_sentry_no_dsn PASSED [ 60%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_init_sentry_success PASSED [ 60%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_before_send_filter_health PASSED [ 60%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_before_send_enrich_trace PASSED [ 60%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_capture_message_sentry PASSED [ 60%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_set_user_sentry PASSED [ 61%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_set_tenant_context_sentry PASSED [ 61%]
tests/unit/core/test_observability_deep.py::TestObservabilityDeep::test_tracing_correlation_id PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_get_tier_config_fallback PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_is_feature_enabled_string_mapping PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_get_tier_limit_unknown_limit PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_tier_missing_user PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_tier_string_mapping PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_tier_invalid_string_mapping PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_feature_missing_user PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_get_tenant_tier_invalid_uuid_string PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_get_tenant_tier_db_exception PASSED [ 61%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_feature_invalid_tier_string_deep PASSED [ 62%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_feature_403_enum PASSED [ 62%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_requires_feature_403_string PASSED [ 62%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_get_tenant_tier_empty PASSED [ 62%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_tier_guard_require_failure_deep PASSED [ 62%]
tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_tier_guard_recursive_limits PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_context_aware_key_tenant PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_context_aware_key_token_hash PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_context_aware_key_ip_fallback PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_get_analysis_limit_tiers PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_check_remediation_rate_limit_memory_fallback PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_check_remediation_rate_limit_redis_success PASSED [ 62%]
tests/unit/core/test_rate_limit.py::test_context_aware_key_hash_exception PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_get_redis_client_no_url PASSED  [ 63%]
tests/unit/core/test_rate_limit.py::test_get_redis_client_loop_change PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_setup_rate_limiting PASSED      [ 63%]
tests/unit/core/test_rate_limit.py::test_rate_limit_decorator_testing_mode PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_check_remediation_rate_limit_redis_limit_exceeded PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_check_remediation_rate_limit_redis_error_fallback PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_check_remediation_rate_limit_memory_window_reset PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_get_redis_client_runtime_error_reset PASSED [ 63%]
tests/unit/core/test_rate_limit.py::test_get_redis_client_same_loop PASSED [ 63%]
tests/unit/core/test_rate_limit_audit.py::test_context_aware_key_tenant_id PASSED [ 63%]
tests/unit/core/test_rate_limit_audit.py::test_context_aware_key_auth_header PASSED [ 63%]
tests/unit/core/test_rate_limit_audit.py::test_context_aware_key_ip_fallback PASSED [ 63%]
tests/unit/core/test_rate_limit_audit.py::test_get_limiter PASSED        [ 64%]
tests/unit/core/test_rate_limit_audit.py::test_get_analysis_limit PASSED [ 64%]
tests/unit/core/test_rate_limit_audit.py::test_check_remediation_rate_limit_redis PASSED [ 64%]
tests/unit/core/test_rate_limit_audit.py::test_check_remediation_rate_limit_fallback_memory PASSED [ 64%]
tests/unit/core/test_rate_limit_audit.py::test_get_redis_client_init PASSED [ 64%]
tests/unit/core/test_rate_limit_audit.py::test_get_redis_client_disabled PASSED [ 64%]
tests/unit/core/test_rate_limit_audit.py::test_setup_rate_limiting PASSED [ 64%]
tests/unit/core/test_rate_limit_expanded.py::test_context_aware_key_tenant_id PASSED [ 64%]
tests/unit/core/test_rate_limit_expanded.py::test_context_aware_key_token_hash PASSED [ 64%]
tests/unit/core/test_rate_limit_expanded.py::test_context_aware_key_ip_fallback PASSED [ 64%]
tests/unit/core/test_rate_limit_expanded.py::test_get_analysis_limit_tiers PASSED [ 64%]
tests/unit/core/test_rate_limit_expanded.py::test_check_remediation_rate_limit_redis_success PASSED [ 64%]
tests/unit/core/test_rate_limit_expanded.py::test_check_remediation_rate_limit_redis_first_call PASSED [ 65%]
tests/unit/core/test_rate_limit_expanded.py::test_check_remediation_rate_limit_redis_error_fallback PASSED [ 65%]
tests/unit/core/test_rate_limit_expanded.py::test_check_remediation_rate_limit_memory_fallback PASSED [ 65%]
tests/unit/core/test_rate_limit_expanded.py::test_check_remediation_rate_limit_memory_reset PASSED [ 65%]
tests/unit/core/test_rate_limit_expanded.py::test_get_limiter_initialization PASSED [ 65%]
tests/unit/core/test_rate_limit_expanded.py::test_setup_rate_limiting PASSED [ 65%]
tests/unit/core/test_rate_limit_expanded.py::test_get_redis_client_logic PASSED [ 65%]
tests/unit/core/test_safety_service_audit.py::test_global_kill_switch_triggered PASSED [ 65%]
tests/unit/core/test_safety_service_audit.py::test_global_kill_switch_allowed PASSED [ 65%]
tests/unit/core/test_safety_service_audit.py::test_monthly_hard_cap_triggered PASSED [ 65%]
tests/unit/core/test_safety_service_audit.py::test_circuit_breaker_triggered PASSED [ 65%]
tests/unit/core/test_safety_service_audit.py::test_check_all_guards_success PASSED [ 65%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_generate_salt PASSED [ 66%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_get_or_create_salt_env PASSED [ 66%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_get_or_create_salt_dev_fallback PASSED [ 66%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_get_or_create_salt_prod_fail PASSED [ 66%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_derive_key PASSED [ 66%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_create_fernet_for_key PASSED [ 66%]
tests/unit/core/test_security_audit.py::TestEncryptionKeyManager::test_create_multi_fernet PASSED [ 66%]
tests/unit/core/test_security_audit.py::test_encrypt_decrypt_roundtrip PASSED [ 66%]
tests/unit/core/test_security_audit.py::test_context_specific_encryption PASSED [ 66%]
tests/unit/core/test_security_audit.py::test_generate_blind_index PASSED [ 66%]
tests/unit/core/test_security_audit.py::test_generate_new_key PASSED     [ 66%]
tests/unit/core/test_security_audit.py::test_decrypt_invalid_input PASSED [ 66%]
tests/unit/core/test_security_audit.py::test_legacy_keys_support PASSED  [ 67%]
tests/unit/core/test_security_audit.py::test_internal_fernet_helpers PASSED [ 67%]
tests/unit/core/test_security_audit.py::test_blind_index_edge_cases PASSED [ 67%]
tests/unit/core/test_security_audit.py::test_kdf_invalid_salt PASSED     [ 67%]
tests/unit/core/test_security_audit.py::test_create_multi_fernet_invalid_key PASSED [ 67%]
tests/unit/core/test_security_gates_audit.py::test_requires_role_enforcement PASSED [ 67%]
tests/unit/core/test_security_gates_audit.py::test_requires_role_hierarchy PASSED [ 67%]
tests/unit/core/test_security_gates_audit.py::test_requires_feature_enforcement PASSED [ 67%]
tests/unit/core/test_security_gates_audit.py::test_get_analyzer_and_provider_dependency PASSED [ 67%]
tests/unit/core/test_session_audit.py::test_get_db_with_request PASSED   [ 67%]
tests/unit/core/test_session_audit.py::test_get_db_no_request PASSED     [ 67%]
tests/unit/core/test_session_audit.py::test_set_session_tenant_id_postgres PASSED [ 67%]
tests/unit/core/test_session_audit.py::test_slow_query_logging PASSED    [ 68%]
tests/unit/core/test_session_audit.py::test_rls_policy_enforcement_metric_increment PASSED [ 68%]
tests/unit/core/test_session_audit.py::test_db_ssl_verify_ca_config PASSED [ 68%]
tests/unit/core/test_session_audit.py::test_startup_missing_db_url PASSED [ 68%]
tests/unit/core/test_session_audit.py::test_rls_policy_enforcement_violation PASSED [ 68%]
tests/unit/core/test_session_audit.py::test_get_db_postgresql_rls_set_failed PASSED [ 68%]
tests/unit/core/test_session_audit.py::test_rls_policy_bypass_more PASSED [ 68%]
tests/unit/core/test_session_audit.py::test_db_ssl_modes_logic PASSED    [ 68%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_setup_tracing_skipped_in_test PASSED [ 68%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_setup_tracing_console PASSED [ 68%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_setup_tracing_otlp PASSED [ 68%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_setup_tracing_fastapi PASSED [ 68%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_set_correlation_id PASSED [ 68%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_get_current_trace_id_valid PASSED [ 69%]
tests/unit/core/test_tracing_deep.py::TestTracingDeep::test_get_current_trace_id_invalid PASSED [ 69%]
tests/unit/db/test_session.py::test_get_db_yields_session PASSED         [ 69%]
tests/unit/db/test_session.py::test_get_db_no_request PASSED             [ 69%]
tests/unit/db/test_session.py::test_before_after_cursor_execute PASSED   [ 69%]
tests/unit/db/test_session.py::test_check_rls_policy_no_leak PASSED      [ 69%]
tests/unit/db/test_session_deep.py::TestSessionDeep::test_get_db_no_request PASSED [ 69%]
tests/unit/db/test_session_deep.py::TestSessionDeep::test_get_db_with_request_tenant PASSED [ 69%]
tests/unit/db/test_session_deep.py::TestSessionDeep::test_set_session_tenant_id PASSED [ 69%]
tests/unit/db/test_session_deep.py::TestSessionDeep::test_before_after_cursor_execute PASSED [ 69%]
tests/unit/db/test_session_deep.py::TestSessionDeep::test_check_rls_policy_exempt PASSED [ 69%]
tests/unit/db/test_session_deep.py::TestSessionDeep::test_check_rls_policy_violation PASSED [ 69%]
tests/unit/governance/test_audit_logger_audit.py::test_audit_logger_initialization PASSED [ 70%]
tests/unit/governance/test_audit_logger_audit.py::test_log_creation_success PASSED [ 70%]
tests/unit/governance/test_audit_logger_audit.py::test_sensitive_data_masking PASSED [ 70%]
tests/unit/governance/test_audit_logger_audit.py::test_log_error_tracking PASSED [ 70%]
tests/unit/governance/test_onboard_audit.py::test_onboard_success PASSED [ 70%]
tests/unit/governance/test_onboard_audit.py::test_onboard_already_exists PASSED [ 70%]
tests/unit/governance/test_onboard_audit.py::test_onboard_invalid_name PASSED [ 70%]
tests/unit/llm/test_analyzer_exhaustive.py::test_load_system_prompt_success PASSED [ 70%]
tests/unit/llm/test_analyzer_exhaustive.py::test_load_system_prompt_fallback PASSED [ 70%]
tests/unit/llm/test_analyzer_exhaustive.py::test_strip_markdown PASSED   [ 70%]
tests/unit/llm/test_analyzer_exhaustive.py::test_analyze_cache_hit_full PASSED [ 70%]
tests/unit/llm/test_analyzer_exhaustive.py::test_analyze_budget_exceeded PASSED [ 70%]
tests/unit/llm/test_analyzer_exhaustive.py::test_analyze_budget_error_unexpected PASSED [ 71%]
tests/unit/llm/test_analyzer_exhaustive.py::test_analyze_flow_success PASSED [ 71%]
tests/unit/llm/test_analyzer_exhaustive.py::test_llm_invocation_primary_failure_fallback PASSED [ 71%]
tests/unit/llm/test_analyzer_exhaustive.py::test_process_results_fallback PASSED [ 71%]
tests/unit/llm/test_budget_manager.py::test_estimate_cost PASSED         [ 71%]
tests/unit/llm/test_budget_manager.py::test_check_and_reserve_success PASSED [ 71%]
tests/unit/llm/test_budget_manager.py::test_check_and_reserve_no_budget PASSED [ 71%]
tests/unit/llm/test_budget_manager.py::test_check_and_reserve_exceeded PASSED [ 71%]
tests/unit/llm/test_budget_manager.py::test_record_usage_success PASSED  [ 71%]
tests/unit/llm/test_budget_manager.py::test_record_usage_explicit_cost PASSED [ 71%]
tests/unit/llm/test_budget_manager.py::test_record_usage_graceful_failure PASSED [ 71%]
tests/unit/llm/test_factory_audit.py::test_validate_api_key_success PASSED [ 71%]
tests/unit/llm/test_factory_audit.py::test_validate_api_key_missing PASSED [ 72%]
tests/unit/llm/test_factory_audit.py::test_validate_api_key_placeholder PASSED [ 72%]
tests/unit/llm/test_factory_audit.py::test_validate_api_key_too_short PASSED [ 72%]
tests/unit/llm/test_factory_audit.py::test_estimate_tokens PASSED        [ 72%]
tests/unit/llm/test_factory_audit.py::test_classify_complexity PASSED    [ 72%]
tests/unit/llm/test_factory_audit.py::test_select_provider_byok PASSED   [ 72%]
tests/unit/llm/test_factory_audit.py::test_select_provider_waterfall_simple PASSED [ 72%]
tests/unit/llm/test_factory_audit.py::test_select_provider_waterfall_medium PASSED [ 72%]
tests/unit/llm/test_factory_audit.py::test_select_provider_waterfall_complex PASSED [ 72%]
tests/unit/llm/test_factory_audit.py::test_estimate_cost PASSED          [ 72%]
tests/unit/llm/test_factory_audit.py::test_create_all_providers PASSED   [ 72%]
tests/unit/llm/test_factory_audit.py::test_create_unsupported PASSED     [ 72%]
tests/unit/llm/test_factory_audit.py::test_create_smart PASSED           [ 73%]
tests/unit/llm/test_factory_modular.py::test_factory_creates_correct_provider[openai-ChatOpenAI] PASSED [ 73%]
tests/unit/llm/test_factory_modular.py::test_factory_creates_correct_provider[anthropic-ChatAnthropic] PASSED [ 73%]
tests/unit/llm/test_factory_modular.py::test_factory_creates_correct_provider[claude-ChatAnthropic] PASSED [ 73%]
tests/unit/llm/test_factory_modular.py::test_factory_invalid_provider PASSED [ 73%]
tests/unit/llm/test_factory_modular.py::test_api_key_validation_failure PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_sanitize_input_normal PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_sanitize_input_injection_direct PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_sanitize_input_homoglyphs PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_sanitize_input_obfuscation PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_validate_output_success PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_validate_output_invalid_json PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_validate_output_schema_mismatch PASSED [ 73%]
tests/unit/llm/test_guardrails_audit.py::test_adversarial_arbiter_keywords PASSED [ 74%]
tests/unit/llm/test_guardrails_audit.py::test_sanitize_input_nested_injection PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_count_tokens_fallback PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_count_tokens_tiktoken PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_calculate_cost PASSED   [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_record_success PASSED   [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_authorize_request_allowed PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_authorize_request_denied PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_check_budget_hard_limit PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_check_budget_fail_closed PASSED [ 74%]
tests/unit/llm/test_usage_tracker_audit.py::test_alert_logic PASSED      [ 74%]
tests/unit/modules/optimization/test_finops_strategies.py::test_compute_savings_analysis_basic PASSED [ 74%]
tests/unit/modules/optimization/test_finops_strategies.py::test_compute_savings_below_threshold PASSED [ 75%]
tests/unit/modules/optimization/test_finops_strategies.py::test_calculate_roi_math PASSED [ 75%]
tests/unit/modules/reporting/test_carbon_scheduler.py::test_carbon_simulation_diurnal PASSED [ 75%]
tests/unit/modules/reporting/test_carbon_scheduler.py::test_forecast_api_logic PASSED [ 75%]
tests/unit/optimization/test_remediation_guardrails.py::test_remediation_kill_switch_triggered PASSED [ 75%]
tests/unit/optimization/test_remediation_guardrails.py::test_remediation_kill_switch_not_triggered PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_create_remediation_request PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_approve_remediation PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_execute_approved_triggers_grace_period PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_execute_immediate_action_success PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_execute_with_backup_aws_rds PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_enforce_hard_limit_triggers_remediation PASSED [ 75%]
tests/unit/optimization/test_remediation_service_audit.py::test_generate_iac_plan_pro_tier PASSED [ 76%]
tests/unit/optimization/test_remediation_service_audit.py::test_generate_iac_plan_free_tier PASSED [ 76%]
tests/unit/optimization/test_unified_discovery.py::test_discover_aws_inventory_resource_explorer_enabled PASSED [ 76%]
tests/unit/optimization/test_unified_discovery.py::test_discover_aws_inventory_resource_explorer_disabled_fallback PASSED [ 76%]
tests/unit/optimization/test_zombie_service_audit.py::test_scan_for_tenant_no_connections PASSED [ 76%]
tests/unit/optimization/test_zombie_service_audit.py::test_scan_for_tenant_success PASSED [ 76%]
tests/unit/optimization/test_zombie_service_audit.py::test_scan_for_tenant_timeout PASSED [ 76%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_initial_state PASSED [ 76%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_failure_threshold PASSED [ 76%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_recovery_timeout PASSED [ 76%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_half_open_success_reset PASSED [ 76%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_budget_exceeded PASSED [ 76%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_redis_persistence PASSED [ 77%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_redis_get_json_fail PASSED [ 77%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_redis_delete PASSED [ 77%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_circuit_breaker_reset PASSED [ 77%]
tests/unit/remediation/test_circuit_breaker_deep.py::TestCircuitBreakerDeep::test_get_circuit_breaker_factory PASSED [ 77%]
tests/unit/services/adapters/test_adapter_factory.py::test_get_adapter_aws_multitenant PASSED [ 77%]
tests/unit/services/adapters/test_adapter_factory.py::test_get_adapter_aws_cur PASSED [ 77%]
tests/unit/services/adapters/test_adapter_factory.py::test_get_adapter_azure PASSED [ 77%]
tests/unit/services/adapters/test_adapter_factory.py::test_get_adapter_gcp PASSED [ 77%]
tests/unit/services/adapters/test_adapter_factory.py::test_get_adapter_by_provider_attribute PASSED [ 77%]
tests/unit/services/adapters/test_adapter_factory.py::test_get_adapter_unsupported PASSED [ 77%]
tests/unit/services/adapters/test_aws_hardening.py::test_adapter_wraps_sts_error PASSED [ 77%]
tests/unit/services/adapters/test_azure_adapter.py::test_azure_verify_connection_success PASSED [ 78%]
tests/unit/services/adapters/test_azure_adapter.py::test_azure_verify_connection_failure PASSED [ 78%]
tests/unit/services/adapters/test_azure_adapter.py::test_azure_get_cost_and_usage_success PASSED [ 78%]
tests/unit/services/adapters/test_azure_adapter.py::test_azure_get_cost_and_usage_error PASSED [ 78%]
tests/unit/services/adapters/test_azure_adapter.py::test_azure_discover_resources PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestInMemoryCache::test_set_get PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestInMemoryCache::test_get_expired PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestInMemoryCache::test_delete PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestInMemoryCache::test_delete_pattern PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestRedisCache::test_set_get PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestRedisCache::test_delete_pattern PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestCostCache::test_get_set_daily_costs PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestCostCache::test_get_set_zombie_scan PASSED [ 78%]
tests/unit/services/adapters/test_cost_cache.py::TestCostCache::test_invalidate_tenant PASSED [ 79%]
tests/unit/services/adapters/test_cost_cache.py::test_get_cost_cache_factory PASSED [ 79%]
tests/unit/services/adapters/test_cur_adapter.py::test_verify_connection_success PASSED [ 79%]
tests/unit/services/adapters/test_cur_adapter.py::test_verify_connection_failure PASSED [ 79%]
tests/unit/services/adapters/test_cur_adapter.py::test_list_cur_files PASSED [ 79%]
tests/unit/services/adapters/test_cur_adapter.py::test_parse_cur_files_success PASSED [ 79%]
tests/unit/services/adapters/test_cur_adapter.py::test_cur_config_from_dict PASSED [ 79%]
tests/unit/services/adapters/test_rate_limiter.py::test_rate_limiter_acquire PASSED [ 79%]
tests/unit/services/adapters/test_rate_limiter.py::test_rate_limiter_waits_when_empty PASSED [ 79%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_throttle_retry_multiple PASSED [ 79%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_generic_throttle_exception PASSED [ 79%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_no_exception_state PASSED [ 79%]
tests/unit/services/adapters/test_rate_limiter.py::test_get_aws_rate_limiter_singleton PASSED [ 80%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_rate_limit PASSED [ 80%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_success PASSED [ 80%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_throttle_retry PASSED [ 80%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_max_retries_exceeded PASSED [ 80%]
tests/unit/services/adapters/test_rate_limiter.py::test_with_backoff_non_throttle_error PASSED [ 80%]
tests/unit/services/adapters/test_rate_limiter.py::test_rate_limited_decorator PASSED [ 80%]
tests/unit/services/billing/test_currency_service.py::test_get_ngn_rate_from_cache PASSED [ 80%]
tests/unit/services/billing/test_currency_service.py::test_get_ngn_rate_stale_cache_fetches_api PASSED [ 80%]
tests/unit/services/billing/test_currency_service.py::test_get_ngn_rate_no_api_key_uses_stale PASSED [ 80%]
tests/unit/services/billing/test_currency_service.py::test_get_ngn_rate_fallback PASSED [ 80%]
tests/unit/services/billing/test_currency_service.py::test_fetch_from_api PASSED [ 80%]
tests/unit/services/billing/test_currency_service.py::test_update_db_cache_insert PASSED [ 81%]
tests/unit/services/billing/test_currency_service.py::test_update_db_cache_update PASSED [ 81%]
tests/unit/services/billing/test_currency_service.py::test_convert_usd_to_ngn PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_process_failed_payment_first_attempt PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_process_failed_payment_max_attempts_reached PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_retry_payment_success PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_retry_payment_failure_continues_dunning PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_handle_retry_success_clears_state PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_handle_final_failure_downgrades PASSED [ 81%]
tests/unit/services/billing/test_dunning_service.py::test_retry_schedule_days PASSED [ 81%]
tests/unit/services/billing/test_paystack_billing.py::TestPaystackClient::test_paystack_client_init_error PASSED [ 81%]
tests/unit/services/billing/test_paystack_billing.py::TestPaystackClient::test_request_success PASSED [ 81%]
tests/unit/services/billing/test_paystack_billing.py::TestPaystackClient::test_request_error PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestBillingService::test_create_checkout_session_trial_error PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestBillingService::test_create_checkout_session_success PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestBillingService::test_charge_renewal_no_auth_code PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestBillingService::test_charge_renewal_success PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestWebhookHandler::test_verify_signature PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestWebhookHandler::test_handle_invalid_signature PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestWebhookHandler::test_handle_charge_success_with_metadata PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestWebhookHandler::test_handle_subscription_create PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestWebhookHandler::test_handle_subscription_disable PASSED [ 82%]
tests/unit/services/billing/test_paystack_billing.py::TestWebhookHandler::test_handle_invoice_failed PASSED [ 82%]
tests/unit/services/carbon/test_budget_alerts.py::test_get_budget_status_ok PASSED [ 82%]
tests/unit/services/carbon/test_budget_alerts.py::test_get_budget_status_warning PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_get_budget_status_exceeded PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_get_budget_status_no_budget PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_get_recommendations_low_usage PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_get_recommendations_exceeded PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_should_send_alert_no_recent PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_should_send_alert_recent_sent PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_mark_alert_sent PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_send_carbon_alert_rate_limited PASSED [ 83%]
tests/unit/services/carbon/test_budget_alerts.py::test_send_carbon_alert_slack PASSED [ 83%]
tests/unit/services/connections/test_organizations.py::test_sync_accounts_non_management PASSED [ 83%]
tests/unit/services/connections/test_organizations.py::test_sync_accounts_sucess PASSED [ 83%]
tests/unit/services/connections/test_organizations.py::test_sync_accounts_update_existing PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_match_conditions_service PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_match_conditions_tags PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_match_conditions_combined PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_apply_rules_direct_allocation PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_apply_rules_percentage_split PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_apply_rules_no_match_default_allocation PASSED [ 84%]
tests/unit/services/costs/test_attribution_engine.py::TestAttributionEngine::test_first_matching_rule_wins PASSED [ 84%]
tests/unit/services/jobs/test_job_handlers.py::test_zombie_scan_handler_no_connections PASSED [ 84%]
tests/unit/services/jobs/test_job_handlers.py::test_zombie_scan_handler_success PASSED [ 84%]
tests/unit/services/jobs/test_job_handlers.py::test_notification_handler_success PASSED [ 84%]
tests/unit/services/jobs/test_job_handlers.py::test_notification_handler_no_message PASSED [ 84%]
tests/unit/services/jobs/test_job_handlers.py::test_webhook_retry_handler_paystack PASSED [ 84%]
tests/unit/services/jobs/test_job_handlers.py::test_webhook_retry_handler_generic_http PASSED [ 85%]
tests/unit/services/jobs/test_job_handlers.py::test_remediation_handler_targeted PASSED [ 85%]
tests/unit/services/jobs/test_job_handlers.py::test_remediation_handler_autonomous_sweep PASSED [ 85%]
tests/unit/services/jobs/test_job_handlers.py::test_finops_analysis_handler_success PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_init_with_prompt_yaml PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_init_with_invalid_yaml PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_analyze_cache_hit PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_check_cache_delta_no_new_data PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_setup_client_budget_degradation PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_setup_client_invalid_provider_fallback PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_setup_client_unsupported_model_fallback PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_check_and_alert_anomalies_slack PASSED [ 85%]
tests/unit/services/llm/test_analyzer_expanded.py::TestFinOpsAnalyzerExpanded::test_check_and_alert_no_anomalies PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_plain_text PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_injection_blocked PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_homoglyph_attack PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_full_width_chars PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_recursive_list PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_recursive_dict PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_validate_output_success PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_validate_output_with_markdown PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_validate_output_failure_invalid_json PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_validate_output_failure_schema_mismatch PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_sanitize_input_adversarial_blocked PASSED [ 86%]
tests/unit/services/llm/test_guardrails_logic.py::test_adversarial_arbiter_true PASSED [ 87%]
tests/unit/services/llm/test_guardrails_logic.py::test_adversarial_arbiter_false PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_should_run_full_analysis_sunday PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_should_run_full_analysis_first_of_month PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_should_run_full_analysis_no_cache PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_run_analysis_force_full PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_run_analysis_delta_path PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_run_full_analysis_logic PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_run_delta_analysis_insignificant PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_run_delta_analysis_significant PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_merge_with_full PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_run_full_analysis_json_error PASSED [ 87%]
tests/unit/services/llm/test_hybrid_scheduler.py::test_convenience_wrapper PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_estimate_tokens PASSED   [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_classify_complexity PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_select_provider_byok_priority PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_select_provider_waterfall_simple PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_select_provider_waterfall_medium PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_select_provider_waterfall_complex PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_estimate_cost_groq PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_estimate_cost_paid_provider PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_llm_factory_create_smart PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_llm_factory_create_google PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_llm_factory_create_groq PASSED [ 88%]
tests/unit/services/llm/test_llm_logic.py::test_llm_factory_create_unsupported PASSED [ 89%]
tests/unit/services/llm/test_llm_usage_tracker.py::test_calculate_cost PASSED [ 89%]
tests/unit/services/llm/test_llm_usage_tracker.py::test_calculate_cost_unknown_model PASSED [ 89%]
tests/unit/services/llm/test_llm_usage_tracker.py::test_authorize_request_within_budget PASSED [ 89%]
tests/unit/services/llm/test_llm_usage_tracker.py::test_authorize_request_exceeds_budget PASSED [ 89%]
tests/unit/services/llm/test_llm_usage_tracker.py::test_check_budget_status_soft_limit PASSED [ 89%]
tests/unit/services/llm/test_llm_usage_tracker.py::test_check_budget_status_hard_limit_fail_closed PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_calculate_cost_openai PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_calculate_cost_unknown PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_record_usage PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_authorize_request_allowed PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_authorize_request_rejected PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_hard_limit PASSED [ 89%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_soft_limit PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_and_alert_sends_slack PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_cache_hit_hard_limit PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_and_alert_skip_if_already_sent PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_and_alert_slack_error_graceful PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_count_tokens_fallback PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_authorize_request_no_budget PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_check_budget_cache_soft_limit PASSED [ 90%]
tests/unit/services/llm/test_usage_tracker_logic.py::test_get_monthly_usage_scalar PASSED [ 90%]
tests/unit/services/llm/test_zombie_analyzer_logic.py::test_analyze_empty_results PASSED [ 90%]
tests/unit/services/llm/test_zombie_analyzer_logic.py::test_analyze_with_byok_config PASSED [ 90%]
tests/unit/services/llm/test_zombie_analyzer_logic.py::test_analyze_usage_tracking PASSED [ 90%]
tests/unit/services/llm/test_zombie_analyzer_logic.py::test_analyze_json_parse_error_fallback PASSED [ 91%]
tests/unit/services/notifications/test_email_service.py::test_escape_html PASSED [ 91%]
tests/unit/services/notifications/test_email_service.py::test_send_carbon_alert_success PASSED [ 91%]
tests/unit/services/notifications/test_email_service.py::test_send_carbon_alert_failure PASSED [ 91%]
tests/unit/services/notifications/test_email_service.py::test_send_dunning_notification PASSED [ 91%]
tests/unit/services/notifications/test_email_service.py::test_send_payment_recovered PASSED [ 91%]
tests/unit/services/notifications/test_email_service.py::test_send_account_downgraded PASSED [ 91%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_escape_mrkdwn_special_chars PASSED [ 91%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_init_sets_client_and_channel PASSED [ 91%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_send_alert_success PASSED [ 91%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_send_alert_deduplication PASSED [ 91%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_send_digest_success PASSED [ 91%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_notify_zombies_with_resources PASSED [ 92%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_notify_zombies_empty PASSED [ 92%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_notify_budget_alert_warning PASSED [ 92%]
tests/unit/services/notifications/test_slack_integration.py::TestSlackService::test_notify_budget_alert_critical PASSED [ 92%]
tests/unit/services/notifications/test_slack_integration.py::TestGetSlackService::test_returns_none_when_not_configured PASSED [ 92%]
tests/unit/services/notifications/test_slack_integration.py::TestGetSlackService::test_returns_service_when_configured PASSED [ 92%]
tests/unit/services/scheduler/test_celery_migration.py::test_orchestrator_dispatches_celery_tasks PASSED [ 92%]
tests/unit/services/scheduler/test_celery_migration.py::test_scheduler_tasks_logic_execution PASSED [ 92%]
tests/unit/services/scheduler/test_processors_expanded.py::TestAnalysisProcessorExpanded::test_process_tenant_no_connections PASSED [ 92%]
tests/unit/services/scheduler/test_processors_expanded.py::TestAnalysisProcessorExpanded::test_process_tenant_timeout PASSED [ 92%]
tests/unit/services/scheduler/test_processors_expanded.py::TestAnalysisProcessorExpanded::test_process_tenant_exception PASSED [ 92%]
tests/unit/services/scheduler/test_processors_expanded.py::TestSavingsProcessorExpanded::test_process_recommendations_no_autonomous PASSED [ 92%]
tests/unit/services/scheduler/test_processors_expanded.py::TestSavingsProcessorExpanded::test_process_recommendations_with_autonomous PASSED [ 93%]
tests/unit/services/scheduler/test_processors_expanded.py::TestSavingsProcessorExpanded::test_process_recommendations_unsupported_action PASSED [ 93%]
tests/unit/services/scheduler/test_processors_expanded.py::TestSavingsProcessorExpanded::test_map_action_to_enum PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestAnalysisProcessor::test_init PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestAnalysisProcessor::test_process_tenant_success PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestSavingsProcessor::test_map_action_to_enum_delete_volume PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestSavingsProcessor::test_map_action_to_enum_delete_snapshot PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestSavingsProcessor::test_map_action_to_enum_unknown PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestSavingsProcessor::test_process_recommendations_empty PASSED [ 93%]
tests/unit/services/scheduler/test_scheduler_processors.py::TestSavingsProcessor::test_process_recommendations_with_autonomous_ready PASSED [ 93%]
tests/unit/services/test_upstash_cache.py::test_get_analysis_hit PASSED  [ 93%]
tests/unit/services/test_upstash_cache.py::test_get_analysis_miss PASSED [ 93%]
tests/unit/services/test_upstash_cache.py::test_set_analysis PASSED      [ 94%]
tests/unit/services/test_upstash_cache.py::test_get_cost_data PASSED     [ 94%]
tests/unit/services/test_upstash_cache.py::test_set_cost_data PASSED     [ 94%]
tests/unit/services/test_upstash_cache.py::test_invalidate_tenant PASSED [ 94%]
tests/unit/services/test_upstash_cache.py::test_get_cache_service_singleton PASSED [ 94%]
tests/unit/services/zombies/aws_provider/test_aws_detector.py::test_initialization PASSED [ 94%]
tests/unit/services/zombies/aws_provider/test_aws_detector.py::test_plugin_registration PASSED [ 94%]
tests/unit/services/zombies/aws_provider/test_aws_detector.py::test_execute_plugin_scan PASSED [ 94%]
tests/unit/services/zombies/azure_provider/test_azure_unattached_disks.py::test_azure_unattached_disks_scan PASSED [ 94%]
tests/unit/services/zombies/azure_provider/test_azure_unattached_disks.py::test_azure_unattached_disks_region_filter PASSED [ 94%]
tests/unit/services/zombies/azure_provider/test_orphaned_ips.py::test_azure_orphaned_ips_scan PASSED [ 94%]
tests/unit/services/zombies/google_provider/test_gcp_unattached_disks.py::test_gcp_unattached_disks_scan PASSED [ 94%]
tests/unit/services/zombies/test_base.py::test_base_detector_scan_success PASSED [ 94%]
tests/unit/services/zombies/test_base.py::test_base_detector_plugin_failure PASSED [ 95%]
tests/unit/services/zombies/test_base.py::test_base_detector_aggregation PASSED [ 95%]
tests/unit/services/zombies/test_factory.py::test_get_detector_aws PASSED [ 95%]
tests/unit/services/zombies/test_factory.py::test_get_detector_azure PASSED [ 95%]
tests/unit/services/zombies/test_factory.py::test_get_detector_gcp PASSED [ 95%]
tests/unit/services/zombies/test_factory.py::test_get_detector_unknown_type PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_create_request_success PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_create_request_unauthorized_connection PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_list_pending_success PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_approve_flow PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_reject_flow PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_execute_errors PASSED [ 95%]
tests/unit/services/zombies/test_remediation_service.py::test_execute_scheduled_successfully PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_execute_grace_period_logic PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_execute_backup_routing PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_execute_backup_failure_aborts PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_get_client_credential_mapping PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_backup_helpers_logic PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_aws_action_dispatcher_comprehensive PASSED [ 96%]
tests/unit/services/zombies/test_remediation_service.py::test_enforce_hard_limit_success PASSED [ 96%]
tests/unit/services/zombies/test_zombie_service.py::test_scan_for_tenant_no_connections PASSED [ 96%]
tests/unit/services/zombies/test_zombie_service.py::test_scan_for_tenant_parallel_success PASSED [ 96%]
tests/unit/services/zombies/test_zombie_service.py::test_scan_for_tenant_timeout_handling PASSED [ 96%]
tests/unit/services/zombies/test_zombie_service.py::test_ai_enrichment_tier_gating PASSED [ 96%]
tests/unit/services/zombies/test_zombie_service.py::test_ai_enrichment_failure_handling PASSED [ 97%]
tests/unit/services/zombies/test_zombie_service.py::test_parallel_scan_exception_handling PASSED [ 97%]
tests/unit/services/zombies/test_zombie_service_expanded.py::TestZombieServiceExpanded::test_scan_for_tenant_no_connections PASSED [ 97%]
tests/unit/services/zombies/test_zombie_service_expanded.py::TestZombieServiceExpanded::test_send_notifications_failure PASSED [ 97%]
tests/unit/shared/llm/providers/test_base.py::TestBaseProvider::test_validate_api_key_valid PASSED [ 97%]
tests/unit/shared/llm/providers/test_base.py::TestBaseProvider::test_validate_api_key_missing PASSED [ 97%]
tests/unit/shared/llm/providers/test_base.py::TestBaseProvider::test_validate_api_key_placeholder PASSED [ 97%]
tests/unit/shared/llm/providers/test_base.py::TestBaseProvider::test_validate_api_key_too_short PASSED [ 97%]
tests/unit/shared/llm/providers/test_base.py::TestBaseProvider::test_create_model_abstract PASSED [ 97%]
tests/unit/shared/llm/test_pricing_data.py::TestProviderCost::test_provider_cost_initialization PASSED [ 97%]
tests/unit/shared/llm/test_pricing_data.py::TestProviderCost::test_provider_cost_defaults PASSED [ 97%]
tests/unit/shared/llm/test_pricing_data.py::TestLLMPricing::test_pricing_structure PASSED [ 97%]
tests/unit/shared/llm/test_pricing_data.py::TestLLMPricing::test_provider_costs_alias PASSED [ 98%]
tests/unit/shared/llm/test_pricing_data.py::TestLLMPricing::test_pricing_values_are_provider_cost PASSED [ 98%]
tests/unit/tasks/test_scheduler_tasks_comprehensive.py::test_cohort_analysis_high_value_success PASSED [ 98%]
tests/unit/tasks/test_scheduler_tasks_comprehensive.py::test_cohort_analysis_deadlock_retry PASSED [ 98%]
tests/unit/tasks/test_scheduler_tasks_comprehensive.py::test_remediation_sweep_success PASSED [ 98%]
tests/unit/tasks/test_scheduler_tasks_comprehensive.py::test_billing_sweep_success PASSED [ 98%]
tests/unit/tasks/test_scheduler_tasks_comprehensive.py::test_maintenance_sweep_success PASSED [ 98%]
tests/unit/test_hard_cap_service.py::test_enforce_hard_cap_suspends_connections PASSED [ 98%]
tests/unit/test_hard_cap_service.py::test_enforce_hard_cap_deactivates_tenant PASSED [ 98%]
tests/unit/test_hard_cap_service.py::test_enforce_hard_cap_logs_correctly PASSED [ 98%]
tests/unit/test_pricing_phase36.py::test_annual_pricing_discount PASSED  [ 98%]
tests/unit/test_pricing_phase36.py::test_pricing_period_consistency PASSED [ 98%]
tests/unit/zombies/aws/test_compute_refactored.py::test_gpu_instance_detection_with_attribution PASSED [ 99%]
tests/unit/zombies/aws/test_compute_refactored.py::test_iac_plan_generation PASSED [ 99%]
tests/unit/zombies/azure/test_idle_vms.py::test_azure_idle_vm_plugin_gpu_detection PASSED [ 99%]
tests/unit/zombies/azure/test_idle_vms.py::test_azure_idle_vm_plugin_attribution PASSED [ 99%]
tests/unit/zombies/gcp/test_idle_instances.py::test_gcp_idle_instance_plugin_gpu_detection PASSED [ 99%]
tests/unit/zombies/gcp/test_idle_instances.py::test_gcp_idle_instance_plugin_standard_instance PASSED [ 99%]
tests/unit/zombies/gcp/test_idle_instances.py::test_gcp_idle_instance_plugin_attribution PASSED [ 99%]
tests/unit/zombies/gcp/test_idle_instances.py::test_gcp_idle_instance_plugin_skips_stopped_instances PASSED [ 99%]
tests/unit/zombies/gcp/test_idle_instances.py::test_gcp_idle_instance_plugin_handles_scan_error PASSED [ 99%]
tests/unit/zombies/test_tier_gating_phase8.py::test_zombie_service_field_masking_starter PASSED [ 99%]
tests/unit/zombies/test_tier_gating_phase8.py::test_zombie_service_no_masking_pro PASSED [ 99%]
tests/unit/zombies/test_tier_gating_phase8.py::test_remediation_service_iac_gating_starter PASSED [ 99%]
tests/unit/zombies/test_tier_gating_phase8.py::test_remediation_service_iac_allowed_pro PASSED [100%]
ERROR: Coverage failure: total of 74 is less than fail-under=80


=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/codecarbon/core/gpu.py:4
  /home/daretechie/DevProject/GitHub/CloudSentinel-AI/.venv/lib/python3.13/site-packages/codecarbon/core/gpu.py:4: FutureWarning: The pynvml package is deprecated. Please install nvidia-ml-py instead. If you did not install pynvml directly, please report this to the maintainers of the package that installed pynvml for you.
    import pynvml

app/modules/optimization/api/v1/strategies.py:16
  /home/daretechie/DevProject/GitHub/CloudSentinel-AI/app/modules/optimization/api/v1/strategies.py:16: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class RecommendationRead(BaseModel):

tests/analysis/test_zombie_coverage.py::test_scan_provider_error_handling
  /home/daretechie/DevProject/GitHub/CloudSentinel-AI/app/modules/optimization/domain/service.py:155: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    logger.error("scan_provider_failed", error=str(e), provider=type(conn).__name__)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/analysis/test_zombie_orchestration.py::test_remediation_service_create_request
  /home/daretechie/DevProject/GitHub/CloudSentinel-AI/app/modules/optimization/domain/remediation.py:113: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    self.db.add(request)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/security/test_encryption.py::test_encryption_with_different_keys
tests/security/test_key_rotation.py::test_key_rotation_compatibility
tests/unit/core/test_security_audit.py::test_context_specific_encryption
tests/unit/core/test_security_audit.py::test_decrypt_invalid_input
  /home/daretechie/DevProject/GitHub/CloudSentinel-AI/.venv/lib/python3.13/site-packages/structlog/_base.py:173: UserWarning: Remove `format_exc_info` from your processor chain if you want pretty exceptions.
    event_dict = proc(self._logger, method_name, event_dict)

tests/unit/core/test_pricing_deep.py::TestPricingDeep::test_get_tenant_tier_empty
  /home/daretechie/DevProject/GitHub/CloudSentinel-AI/tests/unit/core/test_pricing_deep.py:169: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    tier = await get_tenant_tier(uuid.uuid4(), mock_db)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/services/scheduler/test_processors_expanded.py::TestAnalysisProcessorExpanded::test_process_tenant_exception
  /home/daretechie/.local/share/uv/python/cpython-3.13.5-linux-x86_64-gnu/lib/python3.13/unittest/mock.py:2247: RuntimeWarning: coroutine 'AnalysisProcessor.process_tenant.<locals>._run_analysis' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.13.5-final-0 ________________

Name                                                                         Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------------------------------------------------------------------
app/__init__.py                                                                  0      0      0      0   100%
app/main.py                                                                    196     49     18      1    71%   91-130, 151-156, 169-175, 217, 234, 245, 257-267, 278-288, 306, 311, 371-378
app/models/anomaly_marker.py                                                    21      1      0      0    95%   57
app/models/attribution.py                                                       33      0      0      0   100%
app/models/aws_connection.py                                                    40      1      0      0    98%   129
app/models/azure_connection.py                                                  33      1      0      0    97%   68
app/models/background_job.py                                                    55      3      0      0    95%   103-105
app/models/carbon_settings.py                                                   21      0      0      0   100%
app/models/cloud.py                                                             40      0      0      0   100%
app/models/cost_audit.py                                                        20      0      0      0   100%
app/models/discovered_account.py                                                19      1      0      0    95%   43
app/models/gcp_connection.py                                                    34      1      0      0    97%   72
app/models/llm.py                                                               67      8      0      0    88%   97, 156, 160, 164, 168, 172, 176, 185
app/models/notification_settings.py                                             23      1      0      0    96%   61
app/models/optimization.py                                                      48      0      0      0   100%
app/models/pricing.py                                                           25      0      0      0   100%
app/models/remediation.py                                                       67      1      0      0    99%   145
app/models/remediation_settings.py                                              19      1      0      0    95%   51
app/models/security.py                                                          17      0      0      0   100%
app/models/tenant.py                                                            50      1      2      1    96%   26
app/modules/audit/__init__.py                                                    2      0      0      0   100%
app/modules/billing/__init__.py                                                  3      0      0      0   100%
app/modules/governance/__init__.py                                               3      0      0      0   100%
app/modules/governance/api/__init__.py                                           0      0      0      0   100%
app/modules/governance/api/oidc.py                                               9      2      0      0    78%   16, 21
app/modules/governance/api/v1/__init__.py                                        0      0      0      0   100%
app/modules/governance/api/v1/admin.py                                          38     20      6      0    41%   19-45, 55-58, 76-80
app/modules/governance/api/v1/audit.py                                         141      1     14      4    97%   61->64, 164->166, 166->168, 168->172, 389
app/modules/governance/api/v1/health_dashboard.py                              102      2      2      1    97%   224-235
app/modules/governance/api/v1/jobs.py                                          109     42     12      2    57%   88-90, 116, 149-157, 187, 192-194, 219-283, 296-311
app/modules/governance/api/v1/public.py                                         30     15      2      0    47%   17-30, 42-46
app/modules/governance/api/v1/settings/__init__.py                              12      0      0      0   100%
app/modules/governance/api/v1/settings/activeops.py                             43     21      6      0    45%   52-72, 84-118
app/modules/governance/api/v1/settings/carbon.py                                49     21      6      0    51%   60-84, 98-134
app/modules/governance/api/v1/settings/connections.py                          174    105     24      0    35%   52-74, 86-88, 96, 104, 117-144, 153, 164, 179-185, 195-206, 216-232, 243-288, 302-328, 341-342, 351, 360-372, 386-414, 427-428, 436-437, 446-458
app/modules/governance/api/v1/settings/llm.py                                   69     31     12      0    47%   71-97, 119-167, 183-189
app/modules/governance/api/v1/settings/notifications.py                         74     38     10      0    43%   66-94, 108-147, 160-197
app/modules/governance/api/v1/settings/onboard.py                               65     25     16      1    56%   55-101
app/modules/governance/api/v1/settings/safety.py                                47     24      0      0    49%   54-80, 103-126
app/modules/governance/domain/__init__.py                                        0      0      0      0   100%
app/modules/governance/domain/jobs/handlers/__init__.py                         16      0      2      0   100%
app/modules/governance/domain/jobs/handlers/base.py                             81     18      2      0    76%   77, 153-174, 228, 239-271
app/modules/governance/domain/jobs/handlers/billing.py                          28     20      8      0    22%   16-52
app/modules/governance/domain/jobs/handlers/costs.py                           116     78     18      3    31%   29, 45, 66-139, 150-177, 188-227, 238-263
app/modules/governance/domain/jobs/handlers/dunning.py                          16      9      2      0    39%   21-33
app/modules/governance/domain/jobs/handlers/finops.py                           29      2      4      2    88%   24, 33
app/modules/governance/domain/jobs/handlers/notifications.py                    35      2      8      2    91%   26, 52
app/modules/governance/domain/jobs/handlers/remediation.py                      33      3      8      3    85%   22, 44, 54
app/modules/governance/domain/jobs/handlers/zombie.py                           35      6     20      3    76%   21, 28-33, 44->48, 55->54
app/modules/governance/domain/jobs/processor.py                                113     26      8      1    76%   85-92, 100-105, 166->171, 189-204, 207-210
app/modules/governance/domain/scheduler/__init__.py                              3      0      0      0   100%
app/modules/governance/domain/scheduler/cohorts.py                              17      9      8      0    32%   22-36
app/modules/governance/domain/scheduler/metrics.py                               5      0      0      0   100%
app/modules/governance/domain/scheduler/orchestrator.py                         92     20      4      0    75%   43-44, 72-73, 81-82, 90-118
app/modules/governance/domain/scheduler/processors.py                          118     30     38      1    74%   56-92, 111-123, 127-128, 157->164, 161-162
app/modules/governance/domain/security/__init__.py                               0      0      0      0   100%
app/modules/governance/domain/security/audit_log.py                             85      0     10      0   100%
app/modules/governance/domain/security/iam_auditor.py                           72     16     32      9    72%   40, 44, 74-79, 89-91, 100, 104, 107->110, 111->115, 127->102, 135-137
app/modules/health_dashboard/__init__.py                                         2      0      0      0   100%
app/modules/notifications/__init__.py                                            2      0      0      0   100%
app/modules/notifications/domain/__init__.py                                     3      0      0      0   100%
app/modules/notifications/domain/email_service.py                              102     10      4      1    90%   21, 222-224, 278-280, 339-341
app/modules/notifications/domain/slack.py                                       75      8     18      3    88%   63-66, 69-72, 89->94
app/modules/optimization/__init__.py                                             4      0      0      0   100%
app/modules/optimization/adapters/__init__.py                                    0      0      0      0   100%
app/modules/optimization/adapters/aws/__init__.py                                1      0      0      0   100%
app/modules/optimization/adapters/aws/detector.py                               41      0      6      0   100%
app/modules/optimization/adapters/aws/plugins/__init__.py                        9      0      0      0   100%
app/modules/optimization/adapters/aws/plugins/analytics.py                      41     15      8      2    61%   25-27, 35-64
app/modules/optimization/adapters/aws/plugins/compute.py                       112     34     48      9    63%   30-50, 75->73, 77-79, 93-116, 135, 137, 151, 157-161, 208->199, 235-236
app/modules/optimization/adapters/aws/plugins/containers.py                     36     21     12      0    31%   19-52
app/modules/optimization/adapters/aws/plugins/database.py                       84     39     26      5    49%   27-29, 36, 45-102, 117-119, 127-156
app/modules/optimization/adapters/aws/plugins/high_value.py                    111     56     30      5    47%   46-48, 55-91, 121-123, 132-178, 210-253
app/modules/optimization/adapters/aws/plugins/infrastructure.py                123     71     28      3    40%   51-121, 155-195, 228-280
app/modules/optimization/adapters/aws/plugins/network.py                        81     50     24      2    33%   18-71, 86-88, 96-132
app/modules/optimization/adapters/aws/plugins/storage.py                        87     28     18      2    68%   63-66, 97-98, 120-144, 155-182
app/modules/optimization/adapters/aws/region_discovery.py                       63     31     12      2    48%   43, 54-56, 73-75, 84-132, 136, 147-148
app/modules/optimization/adapters/azure/__init__.py                              1      0      0      0   100%
app/modules/optimization/adapters/azure/detector.py                             62     24     28      5    50%   36->46, 56, 62-87, 94, 96, 98, 99->exit
app/modules/optimization/adapters/azure/plugins/__init__.py                     10      0      0      0   100%
app/modules/optimization/adapters/azure/plugins/compute.py                      43     27     10      0    30%   22, 31-70, 79, 83-92
app/modules/optimization/adapters/azure/plugins/containers.py                   55     40     16      0    21%   21, 25-63, 72, 76-117
app/modules/optimization/adapters/azure/plugins/database.py                     27     17      8      0    29%   21, 25-58
app/modules/optimization/adapters/azure/plugins/idle_vms.py                     75     18     28      5    70%   25, 40, 61-67, 73, 109-111, 126->124, 129-132, 143-144
app/modules/optimization/adapters/azure/plugins/network.py                      58     37     14      0    29%   22, 26-60, 69, 73-95, 104, 108-132
app/modules/optimization/adapters/azure/plugins/orphaned_images.py              30      5      8      1    84%   19, 32, 58-60
app/modules/optimization/adapters/azure/plugins/orphaned_ips.py                 25      5      6      1    81%   18, 30, 48-50
app/modules/optimization/adapters/azure/plugins/storage.py                      51     34     10      0    28%   23, 27-64, 73, 77-109
app/modules/optimization/adapters/azure/plugins/unattached_disks.py             50     16     20      3    64%   20, 36-52, 55, 75-77, 87
app/modules/optimization/adapters/gcp/__init__.py                                1      0      0      0   100%
app/modules/optimization/adapters/gcp/detector.py                               69     36     32      2    39%   36->45, 39-43, 56, 62-98
app/modules/optimization/adapters/gcp/plugins/__init__.py                       11      0      0      0   100%
app/modules/optimization/adapters/gcp/plugins/compute.py                        47     31     14      0    26%   22, 31-73, 82, 86-96
app/modules/optimization/adapters/gcp/plugins/containers.py                     54     34     10      0    31%   21, 25-63, 72, 76-84, 93, 97-105
app/modules/optimization/adapters/gcp/plugins/database.py                       28     18      6      0    29%   21, 25-58
app/modules/optimization/adapters/gcp/plugins/idle_instances.py                 87     32     36      6    59%   20, 38->37, 43-45, 65-97, 101, 158->157, 161-164, 168-178
app/modules/optimization/adapters/gcp/plugins/machine_images.py                 26      4      4      0    87%   19, 52-54
app/modules/optimization/adapters/gcp/plugins/network.py                        32     21     10      0    26%   22, 26-64
app/modules/optimization/adapters/gcp/plugins/storage.py                        56     39     14      0    24%   23, 27-68, 77, 81-113
app/modules/optimization/adapters/gcp/plugins/unattached_disks.py               40     11     10      2    70%   18, 40-44, 66-68, 77-80
app/modules/optimization/adapters/gcp/plugins/unused_ips.py                     26      4      4      0    87%   18, 60-62
app/modules/optimization/api/__init__.py                                         0      0      0      0   100%
app/modules/optimization/api/v1/__init__.py                                      0      0      0      0   100%
app/modules/optimization/api/v1/strategies.py                                   47     17      2      0    61%   43-49, 60-63, 80-97
app/modules/optimization/api/v1/zombies.py                                      92     31      6      1    63%   55-65, 86-88, 108, 122, 149-152, 173-186, 189-191, 208-224
app/modules/optimization/domain/__init__.py                                      7      0      0      0   100%
app/modules/optimization/domain/aws_provider/__init__.py                         2      0      0      0   100%
app/modules/optimization/domain/aws_provider/detector.py                         2      0      0      0   100%
app/modules/optimization/domain/aws_provider/plugins/__init__.py                 9      0      0      0   100%
app/modules/optimization/domain/aws_provider/plugins/compute.py                  2      0      0      0   100%
app/modules/optimization/domain/azure_provider/__init__.py                       0      0      0      0   100%
app/modules/optimization/domain/azure_provider/detector.py                       2      0      0      0   100%
app/modules/optimization/domain/azure_provider/plugins/__init__.py               5      0      0      0   100%
app/modules/optimization/domain/azure_provider/plugins/orphaned_images.py        2      0      0      0   100%
app/modules/optimization/domain/azure_provider/plugins/orphaned_ips.py           2      0      0      0   100%
app/modules/optimization/domain/azure_provider/plugins/unattached_disks.py       2      0      0      0   100%
app/modules/optimization/domain/base.py                                          2      0      0      0   100%
app/modules/optimization/domain/detector.py                                      2      0      0      0   100%
app/modules/optimization/domain/factory.py                                      17      0      6      0   100%
app/modules/optimization/domain/gcp_provider/__init__.py                         0      0      0      0   100%
app/modules/optimization/domain/gcp_provider/detector.py                         2      0      0      0   100%
app/modules/optimization/domain/gcp_provider/plugins/__init__.py                 6      0      0      0   100%
app/modules/optimization/domain/gcp_provider/plugins/machine_images.py           2      0      0      0   100%
app/modules/optimization/domain/gcp_provider/plugins/unattached_disks.py         2      0      0      0   100%
app/modules/optimization/domain/gcp_provider/plugins/unused_ips.py               2      0      0      0   100%
app/modules/optimization/domain/plugin.py                                       23      2      6      2    86%   37, 47, 58->61, 61->63
app/modules/optimization/domain/ports.py                                        79     14     18      3    82%   62, 82, 96-101, 125-131, 146-147, 150, 161
app/modules/optimization/domain/registry.py                                     15      0      0      0   100%
app/modules/optimization/domain/remediation.py                                 293     43     72      5    86%   62->65, 338->345, 396-416, 426->442, 475-477, 499-501, 523-525, 618, 645-646, 709-731, 737-739
app/modules/optimization/domain/remediation_service.py                           2      0      0      0   100%
app/modules/optimization/domain/service.py                                     158     54     28      2    67%   127-128, 138->136, 182-222, 266-267, 275, 281-330, 336-359
app/modules/optimization/domain/strategies/base.py                              17      2      0      0    88%   30, 44
app/modules/optimization/domain/strategies/compute_savings.py                   22      0      4      0   100%
app/modules/optimization/domain/unified_discovery.py                            18      0      2      0   100%
app/modules/optimization/domain/zombie_plugin.py                                 2      0      0      0   100%
app/modules/reporting/__init__.py                                                5      0      0      0   100%
app/modules/reporting/api/__init__.py                                            0      0      0      0   100%
app/modules/reporting/api/v1/__init__.py                                         0      0      0      0   100%
app/modules/reporting/api/v1/billing.py                                        185    102     32      3    41%   54-98, 109-130, 143-148, 166, 175-176, 184, 194-200, 209-223, 246-247, 274-279, 281-289, 292-293, 296-298, 309-334, 342-356, 372-388
app/modules/reporting/api/v1/carbon.py                                          78     48     12      0    33%   35-51, 60-96, 105-119, 128-135, 149-156
app/modules/reporting/api/v1/costs.py                                           43     19      4      0    51%   40, 53-66, 87-111, 121-130
app/modules/reporting/api/v1/currency.py                                        21     10      2      0    48%   18-25, 36-41
app/modules/reporting/api/v1/leaderboards.py                                    43     19      6      0    49%   57-113
app/modules/reporting/api/v1/usage.py                                           74      0      0      0   100%
app/modules/reporting/domain/__init__.py                                         3      0      0      0   100%
app/modules/reporting/domain/aggregator.py                                     149     79     32      3    44%   31-40, 54-95, 114-158, 181, 200-203, 211, 254, 271, 360-421, 431-446
app/modules/reporting/domain/attribution_engine.py                             126     44     62      7    62%   60-61, 86, 94-97, 114, 136-177, 206-221, 244-245, 279-317
app/modules/reporting/domain/billing/__init__.py                                 6      2      0      0    67%   11-13
app/modules/reporting/domain/billing/currency.py                                61      8     10      1    87%   47-48, 56-57, 77, 105-107
app/modules/reporting/domain/billing/dunning_service.py                        116     49     14      2    56%   71-72, 136, 148-154, 207-242, 246-272, 276-302
app/modules/reporting/domain/billing/paystack_billing.py                       303     69     74     27    73%   138, 144-150, 154, 158, 162-163, 203-204, 227, 270->275, 282-284, 298-299, 310-316, 329-330, 353-356, 360-381, 411->414, 419-420, 423-424, 446-447, 458-463, 466->468, 468->470, 470->478, 475-476, 491-495, 507->514, 510-511, 515-529, 532-533, 541->exit, 551->556, 561->565, 574->exit, 581->exit, 601->exit, 609->exit
app/modules/reporting/domain/billing/webhook_retry.py                           64     35     16      2    36%   102->112, 103-109, 120-131, 146-154, 158-173, 182-221
app/modules/reporting/domain/budget_alerts.py                                  109     11     44     15    83%   134, 180->230, 192->201, 194, 196, 199, 201->230, 226-227, 235->272, 241->247, 243, 245, 247->272, 266-269, 272->275
app/modules/reporting/domain/calculator.py                                      80     18     26      2    75%   111->104, 130-132, 145-173, 206
app/modules/reporting/domain/carbon_scheduler.py                               125     62     42      6    43%   73-84, 117-135, 146->151, 153, 168, 191, 193, 196-198, 202, 216-232, 245-271, 286-295, 309-325
app/modules/reporting/domain/graviton_analyzer.py                               51      8     18      4    80%   106, 146->135, 151->156, 152->151, 189-191, 204-209
app/modules/reporting/domain/persistence.py                                    118     64     38      5    40%   75, 78-88, 100-132, 137, 140-150, 164-173, 186-255, 259-264, 301-323
app/modules/reporting/domain/pricing/service.py                                 31      7      6      1    78%   34->38, 58-79
app/modules/reporting/domain/service.py                                         63     45     10      0    25%   24, 28-32, 38-120
app/modules/usage/__init__.py                                                    2      0      0      0   100%
app/schemas/connections.py                                                      77      0      0      0   100%
app/schemas/costs.py                                                            33      0      0      0   100%
app/schemas/inventory.py                                                        18      0      0      0   100%
app/shared/__init__.py                                                           0      0      0      0   100%
app/shared/adapters/aws.py                                                       2      0      0      0   100%
app/shared/adapters/aws_cur.py                                                 150     27     32      7    80%   37, 62, 69, 102-104, 136-138, 147-148, 155, 166-169, 189, 208-209, 236-238, 290->294, 328->331, 346->345, 351, 357-359, 362, 378
app/shared/adapters/aws_multitenant.py                                         148     21     34      6    83%   97-100, 104-106, 266->exit, 272->270, 302-306, 319, 330-333, 365-368, 374-384
app/shared/adapters/aws_resource_explorer.py                                    46      6     10      3    84%   72, 74, 87, 91-93
app/shared/adapters/aws_utils.py                                                31     16     14      1    44%   30, 40, 52-72
app/shared/adapters/azure.py                                                    99     21     22      6    73%   36-42, 45-48, 51-57, 65->67, 92, 127->134, 136-142, 167, 200, 202
app/shared/adapters/base.py                                                     15      0      0      0   100%
app/shared/adapters/cost_cache.py                                              184     45     34      9    72%   114-130, 135, 138-140, 145, 148-149, 152-158, 163, 169->172, 172->167, 175-177, 180-187, 271, 296, 325-328, 356->370, 362-363
app/shared/adapters/cur_adapter.py                                             117     35     26      4    70%   72-96, 124->122, 129, 133-135, 153-155, 177->184, 186-188, 191, 224, 239-241, 253-263, 267, 271
app/shared/adapters/factory.py                                                  26      2     12      2    89%   28, 44
app/shared/adapters/gcp.py                                                     104     18     16      4    78%   45-47, 94-95, 107-110, 173-175, 190-192, 212-213, 239-241
app/shared/adapters/rate_limiter.py                                             83      6     16      3    89%   54-55, 169, 184-187
app/shared/analysis/__init__.py                                                  0      0      0      0   100%
app/shared/analysis/azure_usage_analyzer.py                                    120      1     64      9    95%   41->39, 78->54, 117->100, 156->139, 193->177, 227->214, 264->248, 288, 314->302
app/shared/analysis/carbon_data.py                                               3      0      0      0   100%
app/shared/analysis/cur_usage_analyzer.py                                      180      0     98     13    95%   52->60, 151->160, 173->169, 206->214, 226->223, 269->247, 283->278, 313->321, 334->330, 365->374, 386->383, 415->422, 433->432
app/shared/analysis/forecaster.py                                              128      8     32      2    94%   15, 36-37, 90-92, 111->116, 113-114
app/shared/analysis/gcp_usage_analyzer.py                                      115      1     52      7    95%   63, 153->138, 187->174, 218->208, 252->240, 284->273, 320->306
app/shared/cache/__init__.py                                                     3      0      0      0   100%
app/shared/connections/__init__.py                                               6      0      0      0   100%
app/shared/connections/aws.py                                                   36      0      4      0   100%
app/shared/connections/azure.py                                                 24      0      4      0   100%
app/shared/connections/cur_automation.py                                         2      0      0      0   100%
app/shared/connections/gcp.py                                                   21      0      4      0   100%
app/shared/connections/instructions.py                                          14      0      0      0   100%
app/shared/connections/oidc.py                                                  64      0      8      0   100%
app/shared/connections/organizations.py                                         39      0     10      0   100%
app/shared/core/__init__.py                                                      0      0      0      0   100%
app/shared/core/auth.py                                                         98      0     22      2    98%   31->33, 33->36
app/shared/core/cache.py                                                        86      6     18      4    90%   47-48, 50->57, 69->76, 113, 118-120
app/shared/core/celery_app.py                                                   11      1      4      2    80%   38->47, 48
app/shared/core/cloud_connection.py                                             69      1     22      6    92%   84->86, 89->91, 92, 94->97, 110->112, 119->122
app/shared/core/config.py                                                      130     14     32      5    83%   45, 51, 63-81, 100
app/shared/core/constants.py                                                    12      0      0      0   100%
app/shared/core/currency.py                                                     87      3     32      3    95%   53->58, 75->80, 78-79, 104
app/shared/core/dependencies.py                                                 25      2      2      0    93%   24-25
app/shared/core/exceptions.py                                                   42      4      4      1    89%   38, 44, 49, 59
app/shared/core/health.py                                                       58     13     10      4    75%   26, 43-45, 50, 56, 63-65, 76-79
app/shared/core/logging.py                                                      44      1     14      1    97%   18
app/shared/core/middleware.py                                                   34      1      4      1    95%   25
app/shared/core/notifications.py                                                26      3      6      2    78%   25->29, 35->exit, 41-43
app/shared/core/ops_metrics.py                                                  11      0      0      0   100%
app/shared/core/pricing.py                                                     129      3     22      6    94%   238->245, 242-243, 276->282, 309->315, 344, 367->369, 381->exit
app/shared/core/pricing_defaults.py                                              2      0      0      0   100%
app/shared/core/rate_limit.py                                                  111      6     34      4    93%   112, 125, 131-133, 164
app/shared/core/safety_service.py                                               52      1      8      3    93%   78, 94->exit, 129->exit
app/shared/core/security.py                                                    120      7     32      2    93%   119-121, 125-127, 171
app/shared/core/security_metrics.py                                              5      0      0      0   100%
app/shared/core/sentry.py                                                       53     10     18      6    77%   27-30, 107->112, 109-110, 120, 124, 133, 147, 150->exit
app/shared/core/timeout.py                                                      19      3      0      0    84%   40-47
app/shared/core/tracing.py                                                      41      0     10      1    98%   57->exit
app/shared/db/__init__.py                                                        0      0      0      0   100%
app/shared/db/base.py                                                           10      1      2      1    83%   21
app/shared/db/session.py                                                       122     32     50     11    69%   21-23, 30, 34-37, 44-46, 49-51, 59-74, 87-91, 96, 193-194, 228->233, 230-231, 250
app/shared/health/__init__.py                                                    2      0      0      0   100%
app/shared/lead_gen/__init__.py                                                  2      0      0      0   100%
app/shared/lead_gen/assessment.py                                                9      1      2      1    82%   10
app/shared/llm/__init__.py                                                       5      0      0      0   100%
app/shared/llm/analyzer.py                                                     227     20     56      9    90%   70-71, 166->170, 191-193, 210-211, 224, 251-253, 276-277, 314->317, 327->331, 372, 381-388, 447->exit
app/shared/llm/budget_manager.py                                               144     18     36      6    84%   139-140, 170-178, 230-231, 271, 273, 305-312, 316, 319, 358->370, 367-368
app/shared/llm/circuit_breaker.py                                               95     10     30      7    85%   99->110, 112-116, 136->exit, 157-158, 164->exit, 187-191, 208->exit
app/shared/llm/delta_analysis.py                                               133      6     34      8    92%   210->216, 220-225, 228->204, 249->252, 303->301, 314->322, 356->363, 390-407
app/shared/llm/factory.py                                                       82      9     32      3    84%   88-91, 97-100, 106-109
app/shared/llm/guardrails.py                                                   111      4     24      1    95%   92-95
app/shared/llm/hybrid_scheduler.py                                              87      7     22      7    87%   76-81, 94, 122, 124, 151->154, 232-233, 251->254, 254->258
app/shared/llm/pricing_data.py                                                   9      0      0      0   100%
app/shared/llm/providers/__init__.py                                             5      0      0      0   100%
app/shared/llm/providers/anthropic.py                                           10      4      0      0    60%   8-12
app/shared/llm/providers/base.py                                                14      0      6      0   100%
app/shared/llm/providers/google.py                                              10      4      0      0    60%   8-12
app/shared/llm/providers/groq.py                                                10      0      0      0   100%
app/shared/llm/providers/openai.py                                              10      0      0      0   100%
app/shared/llm/usage_tracker.py                                                 45      1      0      0    98%   164
app/shared/llm/zombie_analyzer.py                                               93     13     30      3    80%   91-95, 107->104, 109->108, 199-204, 239-240
app/shared/remediation/autonomous.py                                            22      2      2      0    92%   55-57
app/shared/remediation/circuit_breaker.py                                      105      1     22      1    98%   53
app/shared/remediation/hard_cap_service.py                                      16      0      0      0   100%
app/tasks/scheduler_tasks.py                                                   175     25     38      9    82%   25, 33-34, 49->127, 61, 76->80, 98->85, 117->123, 132, 141->195, 162, 176->154, 187-193, 200, 236->223, 245-247, 254, 267-268, 277-278, 284-288
------------------------------------------------------------------------------------------------------------------------
TOTAL                                                                        12033   2777   2588    380    74%
Coverage HTML written to dir htmlcov
FAIL Required test coverage of 80% not reached. Total coverage: 73.52%
===== 1215 passed, 2 skipped, 2 xfailed, 10 warnings in 154.85s (0:02:34) ======
