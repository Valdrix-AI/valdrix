# Valdrics Koyeb Configuration
# https://www.koyeb.com/docs/deploy/koyeb-files

name: valdrix-api
type: WEB
definition:
  git:
    repository: github.com/Valdrix-AI/valdrix
    branch: main
    builder: docker
    dockerfile: Dockerfile

  scaling:
    min: 1
    max: 3
    targets:
      cpu:
        value: 70

  instance_type: micro

  ports:
    - port: 8000
      protocol: http

  routes:
    - path: /
      port: 8000

  health_checks:
    - type: http
      path: /health
      port: 8000
      interval_seconds: 30
      timeout_seconds: 10
      healthy_threshold: 2
      unhealthy_threshold: 3

  env:
    - name: ENVIRONMENT
      value: production
    - name: WEB_CONCURRENCY
      value: "1"
    - name: LOG_LEVEL
      value: INFO
    - name: LLM_PROVIDER
      value: groq
    - name: SAAS_STRICT_INTEGRATIONS
      value: "true"
    - name: CORS_ORIGINS
      value: "[\"https://dashboard.valdrix.ai\"]"
    # Prophet is not bundled by default; use controlled break-glass fallback metadata.
    - name: FORECASTER_ALLOW_HOLT_WINTERS_FALLBACK
      value: "true"
    - name: FORECASTER_BREAK_GLASS_REASON
      value: "Koyeb deployment baseline while Prophet is not bundled."
    - name: FORECASTER_BREAK_GLASS_EXPIRES_AT
      value: "2099-01-01T00:00:00Z"
    # Secrets - set via Koyeb dashboard
    - name: DATABASE_URL
      secret: valdrix-database-url
    - name: REDIS_URL
      secret: valdrix-redis-url
    - name: SUPABASE_JWT_SECRET
      secret: valdrix-jwt-secret
    - name: ENCRYPTION_KEY
      secret: valdrix-encryption-key
    - name: KDF_SALT
      secret: valdrix-kdf-salt
    - name: CSRF_SECRET_KEY
      secret: valdrix-csrf-secret
    - name: ADMIN_API_KEY
      secret: valdrix-admin-api-key
    - name: GROQ_API_KEY
      secret: valdrix-groq-key
    - name: PAYSTACK_SECRET_KEY
      secret: valdrix-paystack-secret
    - name: PAYSTACK_PUBLIC_KEY
      secret: valdrix-paystack-public
    - name: SENTRY_DSN
      secret: valdrix-sentry-dsn
